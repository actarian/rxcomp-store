/**
 * @license rxcomp-store v1.0.0-beta.10
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e,n,i){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var a=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).active=!1,e}return s(e,t),e.prototype.onToggle=function(){this.active=!this.active,this.pushChanges()},e}(t.Component);a.meta={selector:"json-component",inputs:["item"],template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ json </span>\n\t\t\t\t\t<span *if="active">- json </span>\n\t\t\t\t\t<span [innerHTML]="item"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item">\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item | json"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var c=function(){function t(){}return t.encode=function(t){var e=null;try{var n=new Map,i=JSON.stringify(t,(function(t,e){if("object"==typeof e&&null!=e){if(n.has(e))return;n.set(e,!0)}return e}));e=btoa(encodeURIComponent(i))}catch(e){console.warn("StorageService.encode.error",t,e)}return e},t.decode=function(t){var e;if(t)try{e=JSON.parse(decodeURIComponent(atob(t)))}catch(n){e=t}return e},t.isSupported=function(t){var e,n=!1;try{e=window[t];var i="__storage_test__";e.setItem(i,i),e.removeItem(i),n=!0}catch(t){n=t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&Boolean(e&&0!==e.length)}return n},t}();c.supported=!1;var u=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){var t=this;this.toRawArray().forEach((function(e){t.setter(e.name,"",-1)}))},e.delete=function(t){this.setter(t,"",-1)},e.exist=function(t){return-1!==document.cookie.indexOf(";"+t+"=")||0===document.cookie.indexOf(t+"=")},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e,n){this.setter(t,this.encode(e),n)},e.getRaw=function(t){var e=null,n=this.toRawArray().find((function(e){return e.name===t}));return n&&(e=n.value),e},e.setRaw=function(t,e,n){this.setter(t,e,n)},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){return document.cookie.split(";").map((function(t){var e=t.split("=");return{name:e[0].trim(),value:e[1]?e[1].trim():null}})).filter((function(t){return""!==t.name}))},e.setter=function(t,e,n){var i;if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),i="; expires="+r.toUTCString()}else i="";document.cookie=t+"="+e+i+"; path=/",this.items$.next(this.toArray())},e.isSupported=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(c);u.items$=new n.ReplaySubject(1);var l=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.items=u.toArray(),u.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},i.onToggle=function(){this.active=!this.active,this.pushChanges()},i.onClear=function(){u.clear()},i.onRemove=function(t){u.delete(t.name)},n}(t.Component);l.meta={selector:"cookie-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ cookie</span>\n\t\t\t\t\t<span *if="active">- cookie</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var p=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(localStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(localStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==localStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=localStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(localStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(localStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||c.isSupported("localStorage")},e}(c);p.items$=new n.ReplaySubject(1);var f=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.items=p.toArray(),p.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},i.onToggle=function(){this.active=!this.active,this.pushChanges()},i.onClear=function(){p.clear()},i.onRemove=function(t){p.delete(t.name)},n}(t.Component);f.meta={selector:"local-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ localStorage</span>\n\t\t\t\t\t<span *if="active">- localStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var h=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(sessionStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(sessionStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==sessionStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=sessionStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(sessionStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(sessionStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||c.isSupported("sessionStorage")},e}(c);h.items$=new n.ReplaySubject(1);var d=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.items=h.toArray(),h.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},i.onToggle=function(){this.active=!this.active,this.pushChanges()},i.onClear=function(){h.clear()},i.onRemove=function(t){h.delete(t.name)},n}(t.Component);d.meta={selector:"session-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ sessionStorage</span>\n\t\t\t\t\t<span *if="active">- sessionStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var m=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.transform=function(t){var e=new Map;return JSON.stringify(t,(function(t,n){if("object"==typeof n&&null!=n){if(e.has(n))return"#ref";e.set(n,!0)}return n}),2)},e}(t.Pipe);m.meta={name:"json"};var v,g=[a,l,f,d],y=[m],b=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(t.Module);b.meta={declarations:[].concat(g,y),exports:[].concat(g,y)},function(t){t[t.Memory=1]="Memory",t[t.Session=2]="Session",t[t.Local=3]="Local",t[t.Cookie=4]="Cookie"}(v||(v={}));var x=function(){function t(t,e,r){void 0===t&&(t={}),void 0===e&&(e=v.Memory),void 0===r&&(r="store"),this.type=e,this.key="rxcomp_"+r,t.busy=!1,t.error=null;var o=new n.BehaviorSubject(t);this.next=function(t){return function(e){t.next(i.produce(t.getValue(),(function(t){return"function"==typeof e&&e(t),t})))}}(o),this.nextError=function(t){return function(e){return t.next(i.produce(t.getValue(),(function(t){return t.error=e,t.busy=!1,t}))),n.of(e)}}(o),this.select=function(t){return function(e){return e(t.getValue())}}(o),this.state$=o.asObservable()}var r=t.prototype;return r.busy$=function(){var t=this;return n.of(null).pipe(e.filter((function(){return!t.select((function(t){return t.busy}))&&(t.state=function(t){t.busy=!0,t.error=null},!0)})))},r.cached$=function(t){var i=this;return n.of(null).pipe(e.map((function(){var e=null;return i.type===v.Local?e=p.get(i.key):i.type===v.Session?e=h.get(i.key):i.type===v.Cookie&&(e=u.get(i.key)),e&&"function"==typeof t&&(e=t(e)),e})),e.filter((function(t){return null!=t})))},r.select$=function(t){return this.state$.pipe(e.map(t),e.distinctUntilChanged())},r.select=function(t){},r.next=function(t){},r.nextError=function(t){return n.of()},r.reducer=function(t){var i=this;return function(r){return n.defer((function(){return r.pipe(e.map((function(e){return"function"==typeof t&&(i.state=function(n){n.error=null,t(e,n),n.busy=!1,i.type===v.Local&&p.set(i.key,n),i.type===v.Session&&h.set(i.key,n),i.type===v.Cookie&&u.set(i.key,n,365)}),e})))}))}},r.catchState=function(t){var i=this;return function(r){return n.defer((function(){return r.pipe(e.catchError((function(e){return i.state=function(t){t.error=e,t.busy=!1},(e="function"==typeof t?t(e):null)?n.of(e):n.of()})))}))}},o(t,[{key:"state",get:function(){return this.select((function(t){return t}))},set:function(t){this.next(t)}}]),t}();var S,$,_,w=0,k=function(){function t(){}return t.load$=function(t){return n.of(new Array(1).fill(0).map((function(t,e){var n=(new Date).valueOf()+e;return{id:n,name:w+++" item "+n}}))).pipe(e.delay(300*Math.random()))},t.addItem$=function(t,i){var r=(new Date).valueOf();return Math.random()<.3?n.of(1).pipe(e.delay(300*Math.random()),e.switchMap((function(){return n.throwError("simulated error "+r)}))):n.of({id:r,name:w+++" item "+r}).pipe(e.delay(300*Math.random()))},t.clearItems$=function(t){return n.of([]).pipe(e.delay(300*Math.random()))},t.remove$=function(t,i){return n.of(i).pipe(e.delay(300*Math.random()))},t.patch$=function(t,i){return n.of(i).pipe(e.delay(300*Math.random()))},t}(),C=(S={todolist:[]},$=v.Session,{state$:(_=new x(S,$,"todolist")).state$,busy$:_.busy$.bind(_),cached$:_.cached$.bind(_),select$:_.select$.bind(_),select:_.select.bind(_),next:_.next.bind(_),nextError:_.nextError.bind(_),reducer:_.reducer.bind(_),catchState:_.catchState.bind(_)}),M=C.state$,R=C.busy$,I=C.cached$,A=C.reducer,T=C.catchState,j=function(){function t(){}return t.loadWithCache$=function(){return R().pipe(e.switchMap((function(){return n.merge(I((function(t){return t.todolist})),k.load$("url")).pipe(A((function(t,e){return e.todolist=t})),T(console.log))})))},t.load$=function(){return R().pipe(e.switchMap((function(){return k.load$("url").pipe(A((function(t,e){return e.todolist=t})),T(console.log))})))},t.addItem$=function(){return R().pipe(e.switchMap((function(){return k.addItem$("url").pipe(A((function(t,e){e.todolist.push(t)})),T(console.log))})))},t.clearItems$=function(){return R().pipe(e.switchMap((function(){return k.clearItems$("url").pipe(A((function(t,e){return e.todolist=t})),T(console.log))})))},t.removeItem$=function(t){return R().pipe(e.switchMap((function(){return k.remove$("url",t).pipe(A((function(t,e){var n=e.todolist.reduce((function(e,n,i){return n.id===t?i:e}),-1);-1!==n&&e.todolist.splice(n,1)})),T(console.log))})))},t.toggleCompleted$=function(t){return R().pipe(e.switchMap((function(){return k.patch$("url",t).pipe(A((function(t,e){var n=e.todolist.find((function(e){return e.id===t.id}));n&&(n.completed=!n.completed)})),T(console.log))})))},o(t,null,[{key:"state$",get:function(){return M}}]),t}(),L=0,O=function(n){function i(){return n.apply(this,arguments)||this}s(i,n);var r=i.prototype;return r.onInit=function(){var n=this;t.getContext(this).node.classList.add("init"),j.state$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.state=t,n.pushChanges(),console.log("call",L++)})),j.loadWithCache$().pipe(e.first()).subscribe(console.log)},r.onToggle=function(t){j.toggleCompleted$(t).subscribe(console.log)},r.onAddItem=function(){j.addItem$().subscribe(console.log)},r.onClearItems=function(){j.clearItems$().subscribe(console.log)},r.removeItem=function(t){j.removeItem$(t).subscribe(console.log)},r.clearCookie=function(){u.clear()},r.clearLocalStorage=function(){p.clear()},r.clearSessionStorage=function(){h.clear()},i}(t.Component);O.meta={selector:"[app-component]"};var E=function(t){function n(){return t.apply(this,arguments)||this}return s(n,t),n.prototype.onInit=function(){var t=this;j.state$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.todolist=e.todolist,t.pushChanges()}))},n}(t.Component);E.meta={selector:"counter-component",template:'#items <span [innerHTML]="todolist.length"></span>'};var H=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(t.Module);H.meta={imports:[t.CoreModule,b],declarations:[E],bootstrap:O},t.Browser.bootstrap(H)}(rxcomp,rxjs.operators,rxjs,immer);
//# sourceMappingURL=main.min.js.map