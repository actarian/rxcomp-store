/**
 * @license rxcomp-store v1.0.0-beta.18
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e,n,r){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var c=function(){function e(){}return e.encode=function(e){return t.Serializer.encode(e,[t.encodeJson,encodeURIComponent,t.encodeBase64])||null},e.decode=function(e){return t.Serializer.decode(e,[t.decodeBase64,decodeURIComponent,t.decodeJson])},e.isSupported=function(e){var n,r=!1;try{n=t.WINDOW[e];var i="__storage_test__";n.setItem(i,i),n.removeItem(i),r=!0}catch(t){r=t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&Boolean(n&&0!==n.length)}return r},e}();c.supported=!1;var a=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){var t=this;this.toRawArray().forEach((function(e){t.setter(e.name,"",-1)}))},e.delete=function(t){this.setter(t,"",-1)},e.exist=function(t){return-1!==document.cookie.indexOf(";"+t+"=")||0===document.cookie.indexOf(t+"=")},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e,n){this.setter(t,this.encode(e),n)},e.getRaw=function(t){var e=null,n=this.toRawArray().find((function(e){return e.name===t}));return n&&(e=n.value),e},e.setRaw=function(t,e,n){this.setter(t,e,n)},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){return document.cookie.split(";").map((function(t){var e=t.split("=");return{name:e[0].trim(),value:e[1]?e[1].trim():null}})).filter((function(t){return""!==t.name}))},e.setter=function(t,e,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toUTCString()}else r="";document.cookie=t+"="+e+r+"; path=/",this.items$.next(this.toArray())},e.isSupported=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(c);a.items$=new n.ReplaySubject(1);var u=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.items=a.toArray(),a.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){a.clear()},r.onRemove=function(t){a.delete(t.name)},n}(t.Component);u.meta={selector:"cookie-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ cookie</span>\n\t\t\t\t\t<span *if="active">- cookie</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var l=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(localStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(localStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==localStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=localStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(localStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(localStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||c.isSupported("localStorage")},e}(c);l.items$=new n.ReplaySubject(1);var p=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.items=l.toArray(),l.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){l.clear()},r.onRemove=function(t){l.delete(t.name)},n}(t.Component);p.meta={selector:"local-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ localStorage</span>\n\t\t\t\t\t<span *if="active">- localStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var f=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(sessionStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(sessionStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==sessionStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=sessionStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(sessionStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(sessionStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||c.isSupported("sessionStorage")},e}(c);f.items$=new n.ReplaySubject(1);var d=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.items=f.toArray(),f.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,console.log("SessionStorageComponent.onToggle",this.active),this.pushChanges()},r.onClear=function(){f.clear()},r.onRemove=function(t){f.delete(t.name)},n}(t.Component);d.meta={selector:"session-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ sessionStorage</span>\n\t\t\t\t\t<span *if="active">- sessionStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var h,m=[u,p,d],v=[],y=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(t.Module);y.meta={declarations:[].concat(m,v),exports:[].concat(m,v)},function(t){t[t.Memory=1]="Memory",t[t.Session=2]="Session",t[t.Local=3]="Local",t[t.Cookie=4]="Cookie"}(h||(h={}));var g=function(){function t(t,e,i){void 0===t&&(t={}),void 0===e&&(e=h.Memory),void 0===i&&(i="store"),this.cancel$=new n.Subject,this.type=e,this.key="rxcomp_"+i,t.busy=!1,t.error=null;var o=new n.BehaviorSubject(t);this.next=function(t){return function(e){t.next(r.produce(t.getValue(),(function(t){return"function"==typeof e&&e(t),t})))}}(o),this.nextError=function(t){return function(e){return t.next(r.produce(t.getValue(),(function(t){return t.error=e,t.busy=!1,t.retry=null,t}))),n.of(e)}}(o),this.select=function(t){return function(e){return e(t.getValue())}}(o),this.state$=o.asObservable()}var i=t.prototype;return i.busy$=function(){var t=this;return n.of(null).pipe(e.filter((function(){return!t.select((function(t){return t.busy}))&&(t.state=function(t){t.busy=!0,t.error=null,t.retry=null},!0)})),e.takeUntil(this.cancel$))},i.cached$=function(t){var r=this;return n.of(null).pipe(e.map((function(){var e=null;return r.type===h.Local?e=l.get(r.key):r.type===h.Session?e=f.get(r.key):r.type===h.Cookie&&(e=a.get(r.key)),e&&"function"==typeof t&&(e=t(e)),e})),e.filter((function(t){return null!=t})))},i.select$=function(t){return this.state$.pipe(e.map(t),e.distinctUntilChanged())},i.select=function(t){},i.next=function(t){},i.nextError=function(t){return n.of()},i.reducer=function(t){var r=this;return function(i){return n.defer((function(){return i.pipe(e.map((function(e){return"function"==typeof t&&(r.state=function(n){n.error=null,n.retry=null,t(e,n),n.busy=!1,r.type===h.Local&&l.set(r.key,n),r.type===h.Session&&f.set(r.key,n),r.type===h.Cookie&&a.set(r.key,n,365)}),e})))}))}},i.retryState=function(t,r){var i=this;return void 0===t&&(t=3),void 0===r&&(r=1e3),function(o){return n.defer((function(){var s=0;return o.pipe(e.retryWhen((function(o){return o.pipe(e.delayWhen((function(){return n.timer(r)})),e.switchMap((function(e){return s<t?(s++,i.state=function(t){t.retry=s},n.of(s)):n.throwError(e)})))})))}))}},i.catchState=function(t){var r=this;return function(i){return n.defer((function(){return i.pipe(e.takeUntil(r.cancel$.pipe(e.tap((function(){r.state=function(t){t.busy=!1,t.retry=null}})))),e.catchError((function(e){return r.state=function(t){t.error=e,t.busy=!1,t.retry=null},(e="function"==typeof t?t(e):null)?n.of(e):n.of()})))}))}},i.cancel=function(){this.cancel$.next()},o(t,[{key:"state",get:function(){return this.select((function(t){return t}))},set:function(t){this.next(t)}}]),t}();var b,x,S,$=300,_=0,w=function(){function t(){}return t.load$=function(t){return n.of(new Array(1).fill(0).map((function(t,e){var n=(new Date).valueOf()+e;return{id:n,name:_+++" item "+n}}))).pipe(e.delay($*Math.random()))},t.addItem$=function(t,r){var i=(new Date).valueOf();return n.of({id:i,name:_+++" item "+i}).pipe(e.delay($*Math.random()),e.tap((function(){if(Math.random()<.6)throw"simulated error "+i})))},t.clearItems$=function(t){return n.of([]).pipe(e.delay($*Math.random()))},t.remove$=function(t,r){return n.of(r).pipe(e.delay($*Math.random()))},t.patch$=function(t,r){return n.of(r).pipe(e.delay($*Math.random()))},t}(),k=(b={todolist:[]},x=h.Session,{state$:(S=new g(b,x,"todolist")).state$,busy$:S.busy$.bind(S),cached$:S.cached$.bind(S),select$:S.select$.bind(S),select:S.select.bind(S),next:S.next.bind(S),nextError:S.nextError.bind(S),reducer:S.reducer.bind(S),catchState:S.catchState.bind(S),retryState:S.retryState.bind(S),cancel:S.cancel.bind(S)}),R=k.state$,C=k.busy$,I=k.cached$,M=k.reducer,A=k.catchState,T=k.retryState,L=k.cancel,j=function(){function t(){}return t.loadWithCache$=function(){return C().pipe(e.switchMap((function(){return n.merge(I((function(t){return t.todolist})),w.load$("url")).pipe(M((function(t,e){return e.todolist=t})),A(console.log))})))},t.load$=function(){return C().pipe(e.switchMap((function(){return w.load$("url").pipe(M((function(t,e){return e.todolist=t})),A(console.log))})))},t.addItem$=function(){return C().pipe(e.switchMap((function(){return w.addItem$("url").pipe(M((function(t,e){e.todolist.push(t)})),T(),A(console.log))})))},t.clearItems$=function(){return C().pipe(e.switchMap((function(){return w.clearItems$("url").pipe(M((function(t,e){return e.todolist=t})),A(console.log))})))},t.removeItem$=function(t){return C().pipe(e.switchMap((function(){return w.remove$("url",t).pipe(M((function(t,e){var n=e.todolist.reduce((function(e,n,r){return n.id===t?r:e}),-1);-1!==n&&e.todolist.splice(n,1)})),A(console.log))})))},t.toggleCompleted$=function(t){return C().pipe(e.switchMap((function(){return w.patch$("url",t).pipe(M((function(t,e){var n=e.todolist.find((function(e){return e.id===t.id}));n&&(n.completed=!n.completed)})),A(console.log))})))},o(t,null,[{key:"state$",get:function(){return R}},{key:"cancel",get:function(){return L}}]),t}(),O=0,E=function(n){function r(){return n.apply(this,arguments)||this}s(r,n);var i=r.prototype;return i.onInit=function(){var n=this;t.getContext(this).node.classList.add("init"),j.state$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.state=t,n.pushChanges(),console.log("call",O++)})),j.loadWithCache$().pipe(e.first()).subscribe(console.log)},i.onToggle=function(t){j.toggleCompleted$(t).subscribe(console.log)},i.onAddItem=function(){j.addItem$().subscribe(console.log)},i.onClearItems=function(){j.clearItems$().subscribe(console.log)},i.onCancelRequest=function(){j.cancel()},i.removeItem=function(t){j.removeItem$(t).subscribe(console.log)},i.clearCookie=function(){a.clear()},i.clearLocalStorage=function(){l.clear()},i.clearSessionStorage=function(){f.clear()},r}(t.Component);E.meta={selector:"[app-component]"};var U=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(t.Module);U.meta={imports:[t.CoreModule,y],declarations:[],bootstrap:E},t.Browser.bootstrap(U)}(rxcomp,rxjs.operators,rxjs,immer);
//# sourceMappingURL=main.min.js.map