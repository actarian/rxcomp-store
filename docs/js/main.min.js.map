{"version":3,"sources":["test/js/main.ts","../../src/storage/local-storage.service.ts","../../src/storage/session-storage.service.ts","../../src/store.module.ts","../../src/store/store.ts","../../test/js/api/api.service.ts","../../test/js/todo/todo.service.ts","../../test/js/app.component.ts","../../test/js/counter/counter.component.ts","../../test/js/debug/debug.component.ts","../../test/js/app.module.ts","../../test/js/main.ts"],"names":["rxcomp","immer","rxjs","operators","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_inheritsLoose","subClass","superClass","create","constructor","__proto__","LocalStorageService","clear","this","isLocalStorageSupported","localStorage","delete","name","removeItem","exist","undefined","getItem","get","value","item","JSON","parse","error","console","log","set","cache","Map","json","stringify","has","setItem","supported","window","SessionStorageService","isSessionStorageSupported","sessionStorage","eerror","StoreType","factories","pipes","StoreModule","_Module","apply","arguments","Module","setState","store","callback","output","state","draft","busy","type","Local","Session","setError","of","declarations","concat","exports","Store","Memory","state_","BehaviorSubject","next","produce","getValue","makeSetState","state$","asObservable","PROGRESSIVE_INDEX","ApiService","load$","url","Array","fill","map","x","id","Date","valueOf","pipe","delay","Math","random","addItem$","switchMap","throwError","remove$","patch$","_useStore","todolist","filter","getState","TodoService","loadWithCache$","merge","tap","catchError","push","removeItem$","index","reduce","p","c","splice","toggleCompleted$","stateItem","find","completed","AppComponent","_Component","_proto","onInit","_this","getContext","node","classList","add","takeUntil","unsubscribe$","subscribe","pushChanges","first","onToggle","addItem","Component","selector","CounterComponent","template","DebugComponent","onChanges","innerHTML","debug","inputs","AppModule","imports","CoreModule","bootstrap","Browser"],"mappings":"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","file":"docs\\js\\main.min.js","sourcesContent":[null,"export default class LocalStorageService {\n\n\tstatic supported: boolean = false;\n\n\tstatic clear() {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\tlocalStorage.clear();\n\t\t}\n\t}\n\n\tstatic delete(name: string) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\tlocalStorage.removeItem(name);\n\t\t}\n\t}\n\n\tstatic exist(name: string): boolean {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\treturn localStorage.getItem(name) !== undefined;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstatic get(name: string): any {\n\t\tlet value = null;\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst item = localStorage.getItem(name);\n\t\t\t\tif (item != null) {\n\t\t\t\t\tvalue = JSON.parse(item);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('LocalStorageService.get.error parsing', name, error);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(name: string, value: any) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst cache = new Map();\n\t\t\t\tconst json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.has(value)) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.set(value, true);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tlocalStorage.setItem(name, json);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('LocalStorageService.set.error serializing', name, value, error);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic isLocalStorageSupported(): boolean {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'localStorage' in window && localStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\tlocalStorage.setItem('test', '1');\n\t\t\t\tlocalStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t}\n}\n","export default class SessionStorageService {\n\n\tstatic supported: boolean = false;\n\n\tstatic clear() {\n\t\tif (this.isSessionStorageSupported()) {\n\t\t\tsessionStorage.clear();\n\t\t}\n\t}\n\n\tstatic delete(name: string) {\n\t\tif (this.isSessionStorageSupported()) {\n\t\t\tsessionStorage.removeItem(name);\n\t\t}\n\t}\n\n\tstatic exist(name: string): boolean {\n\t\tif (this.isSessionStorageSupported()) {\n\t\t\treturn sessionStorage.getItem(name) !== undefined;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstatic get(name: string): any {\n\t\tlet value = null;\n\t\tif (this.isSessionStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst item = sessionStorage.getItem(name);\n\t\t\t\tif (item != null) {\n\t\t\t\t\tvalue = JSON.parse(item);\n\t\t\t\t}\n\t\t\t} catch (eerror) {\n\t\t\t\tconsole.log('SessionStorageService.get.error parsing', name, error);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(name: string, value: any) {\n\t\tif (this.isSessionStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst cache = new Map();\n\t\t\t\tconst json = JSON.stringify(value, function (key, value) {\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.has(value)) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.set(value, true);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\tsessionStorage.setItem(name, json);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('SessionStorageService.set.error serializing', name, value, error);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic isSessionStorageSupported(): boolean {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'sessionStorage' in window && sessionStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\tsessionStorage.setItem('test', '1');\n\t\t\t\tsessionStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t}\n}\n","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\n\nconst factories: typeof Factory[] = [\n];\n\nconst pipes: typeof Pipe[] = [];\n\n/**\n * StoreModule Class.\n * @example\n * export default class AppModule extends Module {}\n *\n * AppModule.meta = {\n *  imports: [\n *   CoreModule,\n *   StoreModule\n *  ],\n *  declarations: [\n *   ErrorsComponent\n *  ],\n *  bootstrap: AppComponent,\n * };\n * @extends Module\n */\nexport default class StoreModule extends Module {\n\n\tstatic meta: IModuleMeta = {\n\t\tdeclarations: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t],\n\t\texports: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t]\n\t};\n\n}\n","import { produce } from 'immer';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { filter, map } from 'rxjs/operators';\nimport LocalStorageService from '../storage/local-storage.service';\nimport SessionStorageService from '../storage/session-storage.service';\n\nfunction busy(store: Store): Observable<any> {\n\treturn of(null).pipe(\n\t\tfilter(() => {\n\t\t\tlet busy;\n\t\t\tstore.state = (draft: any) => {\n\t\t\t\tbusy = draft.busy;\n\t\t\t\tif (!busy) {\n\t\t\t\t\tdraft.busy = true;\n\t\t\t\t\tdraft.error = null;\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn !busy;\n\t\t})\n\t);\n}\n\nfunction setState(store: Store): (callback: (draft: any) => any) => any {\n\treturn (callback: (draft: any) => any) => {\n\t\tlet output;\n\t\tstore.state = (draft: any) => {\n\t\t\tdraft.error = null;\n\t\t\toutput = callback(draft);\n\t\t\tdraft.busy = false;\n\t\t\tif (store.type === StoreType.Local) {\n\t\t\t\tLocalStorageService.set(store.key, draft);\n\t\t\t\t// console.log('setState.LocalStorageService.set', store.key, draft);\n\t\t\t}\n\t\t\tif (store.type === StoreType.Session) {\n\t\t\t\tSessionStorageService.set(store.key, draft);\n\t\t\t\t// console.log('setState.SessionStorageService.set', store.key, draft);\n\t\t\t}\n\t\t};\n\t\treturn output;\n\t};\n}\n\nfunction setError(store: Store): (error: any) => Observable<void> {\n\treturn (error: any) => {\n\t\tstore.state = (draft: any) => {\n\t\t\tdraft.error = error;\n\t\t\tdraft.busy = false;\n\t\t};\n\t\treturn of();\n\t};\n}\n\nfunction getState(store: Store, callback: (value: any) => any): Observable<any> {\n\treturn of(null).pipe(\n\t\tmap(() => {\n\t\t\tlet value = null;\n\t\t\tif (store.type === StoreType.Local) {\n\t\t\t\tvalue = LocalStorageService.get(store.key);\n\t\t\t\tif (value && typeof callback === 'function') {\n\t\t\t\t\tvalue = callback(value);\n\t\t\t\t}\n\t\t\t\t// console.log('getLocal.LocalStorageService.get', store.key, value);\n\t\t\t} else if (store.type === StoreType.Session) {\n\t\t\t\tvalue = SessionStorageService.get(store.key);\n\t\t\t\tif (value && typeof callback === 'function') {\n\t\t\t\t\tvalue = callback(value);\n\t\t\t\t}\n\t\t\t\t// console.log('getLocal.SessionStorageService.get', store.key, value);\n\t\t\t}\n\t\t\treturn value;\n\t\t}),\n\t\tfilter((x) => {\n\t\t\t// console.log('value', x);\n\t\t\treturn x !== null;\n\t\t})\n\t);\n}\n\nfunction makeSetState(state: BehaviorSubject<any>): (callback: (draft: any) => any) => void {\n\treturn (callback: (draft: any) => any) => {\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(draft);\n\t\t\t}\n\t\t\treturn draft;\n\t\t}));\n\t};\n}\n\nexport enum StoreType {\n\tMemory = 1,\n\tSession = 2,\n\tLocal = 3,\n};\n\nexport class Store {\n\n\ttype: StoreType;\n\tkey: string;\n\tstate$: Observable<any>;\n\n\tset state(callback: (draft: any) => any) {\n\t\tthis.setState(callback);\n\t}\n\n\tconstructor(state: any = {}, type = StoreType.Memory, key: string = 'store') {\n\t\tthis.type = type;\n\t\tthis.key = `rxcomp_${key}`;\n\t\tstate.busy = false;\n\t\tstate.error = null;\n\t\tconst state_ = new BehaviorSubject(state);\n\t\tthis.setState = makeSetState(state_);\n\t\tthis.state$ = state_.asObservable();\n\t}\n\n\tsetState(callback: (draft: any) => any): void { }\n}\n\nexport interface IStore {\n\tbusy: () => Observable<any>,\n\tgetState: (callback: (draft: any) => any) => any,\n\tsetState: (callback: (draft: any) => any) => any,\n\tsetError: (error: any) => Observable<void>,\n\tstate$: Observable<any>,\n}\n\nexport function useStore(state: any, type?: StoreType, key?: string): IStore {\n\tconst store = new Store(state, type, key);\n\treturn {\n\t\tbusy: () => busy(store),\n\t\tgetState: (callback: (draft: any) => any) => getState(store, callback),\n\t\tsetState: setState(store),\n\t\tsetError: setError(store),\n\t\tstate$: store.state$,\n\t};\n}\n\n","import { Observable, of, throwError } from 'rxjs';\nimport { delay, switchMap } from 'rxjs/operators';\n\nconst DELAY: number = 300;\nlet PROGRESSIVE_INDEX: number = 0;\n\nexport interface ITodoItem {\n\tid?: number;\n\tname?: string;\n\tcompleted?: boolean;\n}\n\nexport default class ApiService {\n\n\tstatic load$(url: string): Observable<ITodoItem[]> {\n\t\t// simulate api call\n\t\treturn of(new Array(1).fill(0).map((x, i) => {\n\t\t\tconst id = new Date().valueOf() + i;\n\t\t\treturn { id: id, name: `${PROGRESSIVE_INDEX++} item ${id}` };\n\t\t})).pipe(\n\t\t\tdelay(DELAY * Math.random())\n\t\t);\n\t}\n\n\tstatic addItem$(url: string, item?: ITodoItem): Observable<ITodoItem> {\n\t\t// simulate api call\n\t\tconst id = new Date().valueOf();\n\t\tif (Math.random() < 0.25) {\n\t\t\t// simulate api error\n\t\t\treturn of(1).pipe(\n\t\t\t\tdelay(DELAY * Math.random()),\n\t\t\t\tswitchMap(() => throwError(`error ${id}`))\n\t\t\t);\n\t\t}\n\t\treturn of({ id: id, name: `${PROGRESSIVE_INDEX++} item ${id}` }).pipe(\n\t\t\tdelay(DELAY * Math.random())\n\t\t);\n\t}\n\n\tstatic remove$(url: string, id: number): Observable<number> {\n\t\t// simulate api call\n\t\treturn of(id).pipe(\n\t\t\tdelay(DELAY * Math.random())\n\t\t);\n\t}\n\n\tstatic patch$(url: string, item: ITodoItem): Observable<ITodoItem> {\n\t\t// simulate api call\n\t\treturn of(item).pipe(\n\t\t\tdelay(DELAY * Math.random())\n\t\t);\n\t}\n}\n","import { merge, Observable } from 'rxjs';\nimport { catchError, switchMap, tap } from 'rxjs/operators';\nimport { StoreType, useStore } from '../../../src/rxcomp-store';\nimport ApiService, { ITodoItem } from '../api/api.service';\n\nconst { state$, busy, getState, setState, setError } = useStore({\n\ttodolist: [],\n}, StoreType.Session, 'todolist');\n\nexport class TodoService {\n\n\tstatic get state$() {\n\t\treturn state$;\n\t}\n\n\tstatic loadWithCache$(): Observable<ITodoItem[] | void> {\n\t\treturn busy().pipe(\n\t\t\tswitchMap(() => merge(getState((state: any) => state.todolist) as Observable<ITodoItem[]>, ApiService.load$('url')).pipe(\n\t\t\t\ttap((todolist: ITodoItem[]) => setState((state: any) => (state.todolist = todolist))),\n\t\t\t\tcatchError((error: any) => setError(error))\n\t\t\t)));\n\t}\n\n\tstatic load$(): Observable<ITodoItem[] | void> {\n\t\treturn busy().pipe(\n\t\t\tswitchMap(() => ApiService.load$('url').pipe(\n\t\t\t\ttap((todolist: ITodoItem[]) => setState((state: any) => (state.todolist = todolist))),\n\t\t\t\tcatchError((error: any) => setError(error))\n\t\t\t)));\n\t}\n\n\tstatic addItem$(): Observable<ITodoItem | void> {\n\t\treturn busy().pipe(\n\t\t\tswitchMap(() => ApiService.addItem$('url').pipe(\n\t\t\t\ttap((item) => setState((state: any) => {\n\t\t\t\t\tstate.todolist.push(item);\n\t\t\t\t})),\n\t\t\t\tcatchError((error: any) => setError(error))\n\t\t\t))\n\t\t);\n\t}\n\n\tstatic removeItem$(id: number): Observable<number | void> {\n\t\treturn busy().pipe(\n\t\t\tswitchMap(() => ApiService.remove$('url', id).pipe(\n\t\t\t\ttap((id) => setState((state: any) => {\n\t\t\t\t\tconst index = state.todolist.reduce((p: number, c: ITodoItem, i: number) => {\n\t\t\t\t\t\treturn c.id === id ? i : p;\n\t\t\t\t\t}, -1);\n\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\tstate.todolist.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t})),\n\t\t\t\tcatchError((error: any) => setError(error))\n\t\t\t))\n\t\t);\n\t}\n\n\tstatic toggleCompleted$(item: ITodoItem): Observable<ITodoItem | void> {\n\t\treturn busy().pipe(\n\t\t\tswitchMap(() => ApiService.patch$('url', item).pipe(\n\t\t\t\ttap((item) => setState((state: any) => {\n\t\t\t\t\tconst stateItem = state.todolist.find((x: ITodoItem) => x.id === item.id);\n\t\t\t\t\tif (stateItem) {\n\t\t\t\t\t\tstateItem.completed = !stateItem.completed;\n\t\t\t\t\t}\n\t\t\t\t})),\n\t\t\t\tcatchError((error: any) => setError(error))\n\t\t\t)));\n\t}\n\n}\n\n","import { Component, getContext, IFactoryMeta } from 'rxcomp';\nimport { first, takeUntil } from 'rxjs/operators';\nimport { ITodoItem } from './api/api.service';\nimport { TodoService } from './todo/todo.service';\n\nlet c: number = 0;\n\nexport default class AppComponent extends Component {\n\n\tonInit() {\n\t\tconst { node } = getContext(this);\n\t\tnode.classList.add('init');\n\t\tTodoService.state$.pipe(takeUntil(this.unsubscribe$)).subscribe((state) => {\n\t\t\tthis.todolist = state.todolist;\n\t\t\tthis.error = state.error;\n\t\t\tthis.busy = state.busy;\n\t\t\tthis.pushChanges();\n\t\t\tconsole.log('call', c++);\n\t\t});\n\t\tTodoService.loadWithCache$()\n\t\t\t.pipe(first())\n\t\t\t.subscribe(console.log);\n\t}\n\n\tonToggle(item: ITodoItem) {\n\t\tTodoService.toggleCompleted$(item).subscribe(console.log);\n\t}\n\n\taddItem() {\n\t\tTodoService.addItem$().subscribe(console.log);\n\t}\n\n\tremoveItem(id: number) {\n\t\tTodoService.removeItem$(id).subscribe(console.log);\n\t}\n\n\tstatic meta: IFactoryMeta = {\n\t\tselector: '[app-component]',\n\t};\n\n}\n","import { Component, IFactoryMeta } from 'rxcomp';\nimport { takeUntil } from 'rxjs/operators';\nimport { TodoService } from '../todo/todo.service';\n\nexport default class CounterComponent extends Component {\n\n\tonInit() {\n\t\tTodoService.state$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe((state) => {\n\t\t\tthis.todolist = state.todolist;\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n\tstatic meta: IFactoryMeta = {\n\t\tselector: 'counter-component',\n\t\ttemplate: `#items <span [innerHTML]=\"todolist.length\"></span>`\n\t};\n\n}\n","import { Component, getContext, IFactoryMeta } from 'rxcomp';\n\nexport default class DebugComponent extends Component {\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tnode.innerHTML = this.debug ? JSON.stringify(this.debug, null, 2) : this.debug;\n\t}\n\n\tstatic meta: IFactoryMeta = {\n\t\tselector: '[debug-component]',\n\t\tinputs: ['debug'],\n\t};\n}\n","import { CoreModule, IModuleMeta, Module } from 'rxcomp';\nimport { StoreModule } from '../../src/rxcomp-store';\nimport AppComponent from './app.component';\nimport CounterComponent from './counter/counter.component';\nimport DebugComponent from './debug/debug.component';\n\nexport default class AppModule extends Module {\n\n\tstatic meta: IModuleMeta = {\n\t\timports: [\n\t\t\tCoreModule,\n\t\t\tStoreModule\n\t\t],\n\t\tdeclarations: [\n\t\t\tCounterComponent,\n\t\t\tDebugComponent\n\t\t],\n\t\tbootstrap: AppComponent,\n\t};\n\n}\n","import { Browser } from 'rxcomp';\r\nimport AppModule from './app.module';\r\n\r\nBrowser.bootstrap(AppModule);\r\n"]}