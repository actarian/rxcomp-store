{"version":3,"sources":["test/js/main.ts","../../src/storage/storage.service.ts","../../src/storage/cookie-storage.service.ts","../../src/storage/cookie-storage.component.ts","../../src/storage/local-storage.service.ts","../../src/storage/local-storage.component.ts","../../src/storage/session-storage.service.ts","../../src/storage/session-storage.component.ts","../../src/store.module.ts","../../src/store/store.ts","../../test/js/api/api.service.ts","../../test/js/todo/todo.service.ts","../../test/js/app.component.ts","../../test/js/app.module.ts","../../test/js/main.ts"],"names":["rxcomp","operators","rxjs","immer","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_inheritsLoose","subClass","superClass","create","constructor","__proto__","StorageService","encode","value","encodedJson","cache","Map","json","JSON","stringify","has","set","btoa","encodeURIComponent","error","console","warn","decode","parse","decodeURIComponent","atob","isSupported","type","storage","flag","window","x","setItem","removeItem","DOMException","code","name","Boolean","CookieStorageService","_StorageService","apply","this","arguments","clear","_this","toRawArray","forEach","setter","delete","exist","document","cookie","indexOf","get","getRaw","days","find","setRaw","toArray","_this2","map","split","items","trim","filter","expires","date","Date","setTime","getTime","toUTCString","items$","next","ReplaySubject","CookieStorageComponent","_Component","active","_proto","onInit","pipe","takeUntil","unsubscribe$","subscribe","pushChanges","onToggle","onClear","onRemove","item","Component","selector","template","LocalStorageService","localStorage","undefined","getItem","keys","supported","LocalStorageComponent","SessionStorageService","sessionStorage","SessionStorageComponent","StoreType","factories","pipes","StoreModule","_Module","Module","declarations","concat","exports","Store","state","Memory","cancel$","Subject","busy","state_","BehaviorSubject","callback","produce","getValue","draft","makeNext","nextError","retry","of","makeNextError","select","makeSelect","state$","asObservable","busy$","cached$","Local","Session","Cookie","select$","distinctUntilChanged","reducer","_this3","source","defer","data","retryState","times","delay","_this4","retryWhen","errors","delayWhen","timer","switchMap","throwError","catchState","errorReducer","_this5","tap","catchError","cancel","store","DELAY","PROGRESSIVE_INDEX","ApiService","load$","url","Array","fill","id","valueOf","Math","random","addItem$","clearItems$","remove$","patch$","_useStore","todolist","bind","TodoService","loadWithCache$","merge","log","push","removeItem$","index","reduce","p","c","splice","toggleCompleted$","stateItem","completed","AppComponent","getContext","node","classList","add","first","onAddItem","onClearItems","onCancelRequest","clearCookie","clearLocalStorage","clearSessionStorage","AppModule","imports","CoreModule","bootstrap","Browser"],"mappings":"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","file":"docs\\js\\main.min.js","sourcesContent":[null,"\r\nexport interface IStorageItem {\r\n\tname: string;\r\n\tvalue: any;\r\n}\r\n\r\nexport default class StorageService {\r\n\r\n\tstatic supported: boolean = false;\r\n\r\n\tstatic encode(value: any): string | null {\r\n\t\tlet encodedJson: string | null = null;\r\n\t\ttry {\r\n\t\t\tconst cache: Map<any, boolean> = new Map();\r\n\t\t\tconst json: string = JSON.stringify(value, function (key, value) {\r\n\t\t\t\tif (typeof value === 'object' && value != null) {\r\n\t\t\t\t\tif (cache.has(value)) {\r\n\t\t\t\t\t\t// Circular reference found, discard key\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcache.set(value, true);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t});\r\n\t\t\tencodedJson = btoa(encodeURIComponent(json));\r\n\t\t} catch (error) {\r\n\t\t\tconsole.warn('StorageService.encode.error', value, error);\r\n\t\t}\r\n\t\treturn encodedJson;\r\n\t}\r\n\r\n\tstatic decode(encodedJson: string | null): any {\r\n\t\tlet value: any;\r\n\t\tif (encodedJson) {\r\n\t\t\ttry {\r\n\t\t\t\tvalue = JSON.parse(decodeURIComponent(atob(encodedJson)));\r\n\t\t\t} catch (error) {\r\n\t\t\t\t// console.warn('StorageService.decode.error', encodedJson);\r\n\t\t\t\tvalue = encodedJson;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic isSupported(type: 'localStorage' | 'sessionStorage'): boolean {\r\n\t\tlet flag: boolean = false;\r\n\t\tlet storage;\r\n\t\ttry {\r\n\t\t\tstorage = window[type];\r\n\t\t\tconst x = '__storage_test__';\r\n\t\t\tstorage.setItem(x, x);\r\n\t\t\tstorage.removeItem(x);\r\n\t\t\tflag = true;\r\n\t\t} catch (error) {\r\n\t\t\tflag = error instanceof DOMException && (\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\terror.code === 22 ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\terror.code === 1014 ||\r\n\t\t\t\t// test name field too, because code might not be present\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\terror.name === 'QuotaExceededError' ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\terror.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\r\n\t\t\t\t// acknowledge QuotaExceededError only if there's something already stored\r\n\t\t\t\tBoolean(storage && storage.length !== 0);\r\n\t\t}\r\n\t\treturn flag;\r\n\t}\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class CookieStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tthis.toRawArray().forEach(x => {\r\n\t\t\tthis.setter(x.name, '', -1);\r\n\t\t\t// document.cookie = `${x.name}= ; expires = Thu, 01 Jan 1970 00:00:00 GMT`;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tthis.setter(name, '', -1);\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any, days?: number): void {\r\n\t\tthis.setter(name, this.encode(value), days);\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tconst cookies = this.toRawArray();\r\n\t\tconst cookie = cookies.find(x => x.name === name);\r\n\t\tif (cookie) {\r\n\t\t\tvalue = cookie.value;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string, days?: number): void {\r\n\t\tthis.setter(name, value, days);\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\treturn document.cookie.split(';').map(x => {\r\n\t\t\tconst items = x.split('=');\r\n\t\t\treturn { name: items[0].trim(), value: items[1] ? items[1].trim() : null }\r\n\t\t}).filter(x => x.name !== '');\r\n\t}\r\n\r\n\tstatic setter(name: string, value: any, days?: number): void {\r\n\t\tlet expires: string;\r\n\t\tif (days) {\r\n\t\t\tconst date = new Date();\r\n\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n\t\t\texpires = '; expires=' + date.toUTCString();\r\n\t\t} else {\r\n\t\t\texpires = '';\r\n\t\t}\r\n\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\r\n\t\tthis.items$.next(this.toArray());\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tconst isBrowser: boolean = typeof window !== 'undefined' && typeof window.document !== 'undefined';\r\n\t\treturn isBrowser;\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport CookieStorageService from './cookie-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class CookieStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = CookieStorageService.toArray();\r\n\t\tCookieStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tCookieStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tCookieStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'cookie-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ cookie</span>\r\n\t\t\t\t\t<span *if=\"active\">- cookie</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class LocalStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tlocalStorage.clear();\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tlocalStorage.removeItem(name);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn localStorage.getItem(name) !== undefined;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any): void {\r\n\t\tthis.setRaw(name, this.encode(value));\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tif (this.isSupported()) {\r\n\t\t\tvalue = localStorage.getItem(name);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string | null): void {\r\n\t\tif (value && this.isSupported()) {\r\n\t\t\tlocalStorage.setItem(name, value);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn Object.keys(localStorage).map(key => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: key,\r\n\t\t\t\t\tvalue: this.getRaw(key),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tif (this.supported) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn StorageService.isSupported('localStorage');\r\n\t\t/*\r\n\t\tlet supported = false;\r\n\t\ttry {\r\n\t\t\tsupported = 'localStorage' in window && localStorage !== null;\r\n\t\t\tif (supported) {\r\n\t\t\t\tlocalStorage.setItem('test', '1');\r\n\t\t\t\tlocalStorage.removeItem('test');\r\n\t\t\t} else {\r\n\t\t\t\tsupported = false;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\tthis.supported = supported;\r\n\t\treturn supported;\r\n\t\t*/\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport LocalStorageService from './local-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class LocalStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = LocalStorageService.toArray();\r\n\t\tLocalStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tLocalStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tLocalStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'local-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ localStorage</span>\r\n\t\t\t\t\t<span *if=\"active\">- localStorage</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class SessionStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tsessionStorage.clear();\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tsessionStorage.removeItem(name);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn sessionStorage.getItem(name) !== undefined;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any): void {\r\n\t\tthis.setRaw(name, this.encode(value));\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tif (this.isSupported()) {\r\n\t\t\tvalue = sessionStorage.getItem(name);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string | null): void {\r\n\t\tif (value && this.isSupported()) {\r\n\t\t\tsessionStorage.setItem(name, value);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn Object.keys(sessionStorage).map(key => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: key,\r\n\t\t\t\t\tvalue: this.getRaw(key),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tif (this.supported) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn StorageService.isSupported('sessionStorage');\r\n\t\t/*\r\n\t\tlet supported = false;\r\n\t\ttry {\r\n\t\t\tsupported = 'sessionStorage' in window && sessionStorage !== null;\r\n\t\t\tif (supported) {\r\n\t\t\t\tsessionStorage.setItem('test', '1');\r\n\t\t\t\tsessionStorage.removeItem('test');\r\n\t\t\t} else {\r\n\t\t\t\tsupported = false;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\tthis.supported = supported;\r\n\t\treturn supported;\r\n\t\t*/\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport SessionStorageService from './session-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class SessionStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = SessionStorageService.toArray();\r\n\t\tSessionStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tSessionStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tSessionStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'session-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ sessionStorage</span>\r\n\t\t\t\t\t<span *if=\"active\">- sessionStorage</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\r\nimport CookieStorageComponent from './storage/cookie-storage.component';\r\nimport LocalStorageComponent from './storage/local-storage.component';\r\nimport SessionStorageComponent from './storage/session-storage.component';\r\n\r\nconst factories: typeof Factory[] = [\r\n\tCookieStorageComponent,\r\n\tLocalStorageComponent,\r\n\tSessionStorageComponent,\r\n];\r\n\r\nconst pipes: typeof Pipe[] = [\r\n];\r\n\r\n/**\r\n * StoreModule Class.\r\n * @example\r\n * export default class AppModule extends Module {}\r\n *\r\n * AppModule.meta = {\r\n *  imports: [\r\n *   CoreModule,\r\n *   StoreModule\r\n *  ],\r\n *  declarations: [\r\n *   ErrorsComponent\r\n *  ],\r\n *  bootstrap: AppComponent,\r\n * };\r\n * @extends Module\r\n */\r\nexport default class StoreModule extends Module {\r\n\r\n\tstatic meta: IModuleMeta = {\r\n\t\tdeclarations: [\r\n\t\t\t...factories,\r\n\t\t\t...pipes,\r\n\t\t],\r\n\t\texports: [\r\n\t\t\t...factories,\r\n\t\t\t...pipes,\r\n\t\t]\r\n\t};\r\n\r\n}\r\n","import { produce } from 'immer';\r\nimport { BehaviorSubject, defer, Observable, of, Subject, throwError, timer } from 'rxjs';\r\nimport { catchError, delayWhen, distinctUntilChanged, filter, map, retryWhen, switchMap, takeUntil, tap } from 'rxjs/operators';\r\nimport CookieStorageService from '../storage/cookie-storage.service';\r\nimport LocalStorageService from '../storage/local-storage.service';\r\nimport SessionStorageService from '../storage/session-storage.service';\r\n\r\nexport enum StoreType {\r\n\tMemory = 1,\r\n\tSession = 2,\r\n\tLocal = 3,\r\n\tCookie = 4,\r\n};\r\n\r\nexport interface IStore {\r\n\tbusy$: () => Observable<null>;\r\n\treducer: <T, R>(reducer: (data: T, draft: any) => R) => (source: Observable<T>) => Observable<any>;\r\n\tnext: (callback: (draft: any) => any) => any;\r\n\tnextError: (error: any) => Observable<any>;\r\n\tselect: (callback: (draft: any) => any) => any;\r\n\tselect$: (callback: (draft: any) => any) => any;\r\n\tcached$: (callback: (draft: any) => any) => any;\r\n\tcatchState: (error?: any) => any;\r\n\tretryState: (times?: number, delay?: number) => (source: Observable<any>) => Observable<any>;\r\n\tcancel: () => void;\r\n\tstate$: Observable<any>;\r\n}\r\n\r\nexport class Store {\r\n\r\n\ttype: StoreType;\r\n\tkey: string;\r\n\tstate$: Observable<any>;\r\n\tcancel$: Subject<void> = new Subject;\r\n\r\n\tget state() {\r\n\t\treturn this.select((draft: any) => draft);\r\n\t}\r\n\r\n\tset state(callback: (draft: any) => any) {\r\n\t\tthis.next(callback);\r\n\t}\r\n\r\n\tconstructor(state: any = {}, type = StoreType.Memory, key: string = 'store') {\r\n\t\tthis.type = type;\r\n\t\tthis.key = `rxcomp_${key}`;\r\n\t\tstate.busy = false;\r\n\t\tstate.error = null;\r\n\t\tconst state_ = new BehaviorSubject(state);\r\n\t\tthis.next = makeNext(state_);\r\n\t\tthis.nextError = makeNextError(state_);\r\n\t\tthis.select = makeSelect(state_);\r\n\t\tthis.state$ = state_.asObservable();\r\n\t}\r\n\r\n\tbusy$(): Observable<null> {\r\n\t\treturn of(null).pipe(\r\n\t\t\tfilter(() => {\r\n\t\t\t\tlet busy = this.select(state => state.busy);\r\n\t\t\t\tif (!busy) {\r\n\t\t\t\t\tthis.state = (draft: any) => {\r\n\t\t\t\t\t\tdraft.busy = true;\r\n\t\t\t\t\t\tdraft.error = null;\r\n\t\t\t\t\t\tdraft.retry = null;\r\n\t\t\t\t\t};\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\ttakeUntil(this.cancel$),\r\n\t\t);\r\n\t}\r\n\r\n\tcached$(callback: (value: any) => any): Observable<any> {\r\n\t\treturn of(null).pipe(\r\n\t\t\tmap(() => {\r\n\t\t\t\tlet value = null;\r\n\t\t\t\tif (this.type === StoreType.Local) {\r\n\t\t\t\t\tvalue = LocalStorageService.get(this.key);\r\n\t\t\t\t} else if (this.type === StoreType.Session) {\r\n\t\t\t\t\tvalue = SessionStorageService.get(this.key);\r\n\t\t\t\t} else if (this.type === StoreType.Cookie) {\r\n\t\t\t\t\tvalue = CookieStorageService.get(this.key);\r\n\t\t\t\t}\r\n\t\t\t\tif (value && typeof callback === 'function') {\r\n\t\t\t\t\tvalue = callback(value);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}),\r\n\t\t\tfilter((x) => {\r\n\t\t\t\t// console.log('value', x);\r\n\t\t\t\treturn x != null;\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tselect$(callback: (draft: any) => any): Observable<any> {\r\n\t\treturn this.state$.pipe(\r\n\t\t\tmap(callback),\r\n\t\t\tdistinctUntilChanged()\r\n\t\t);\r\n\t}\r\n\r\n\tselect(callback: (draft: any) => any): any { }\r\n\r\n\tnext(callback: (draft: any) => any): void { }\r\n\r\n\tnextError(error: any): Observable<any> {\r\n\t\treturn of();\r\n\t}\r\n\r\n\treducer<T, R>(reducer: (data: T, draft: any) => R) {\r\n\t\treturn (source: Observable<T>) => defer(() => {\r\n\t\t\t// initialize global values\r\n\t\t\treturn source.pipe(\r\n\t\t\t\tmap((data: T) => {\r\n\t\t\t\t\tif (typeof reducer === 'function') {\r\n\t\t\t\t\t\tthis.state = (draft: any) => {\r\n\t\t\t\t\t\t\tdraft.error = null;\r\n\t\t\t\t\t\t\tdraft.retry = null;\r\n\t\t\t\t\t\t\treducer(data, draft);\r\n\t\t\t\t\t\t\tdraft.busy = false;\r\n\t\t\t\t\t\t\tif (this.type === StoreType.Local) {\r\n\t\t\t\t\t\t\t\tLocalStorageService.set(this.key, draft);\r\n\t\t\t\t\t\t\t\t// console.log('reducer.LocalStorageService.set', this.key, draft);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (this.type === StoreType.Session) {\r\n\t\t\t\t\t\t\t\tSessionStorageService.set(this.key, draft);\r\n\t\t\t\t\t\t\t\t// console.log('reducer.SessionStorageService.set', this.key, draft);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (this.type === StoreType.Cookie) {\r\n\t\t\t\t\t\t\t\tCookieStorageService.set(this.key, draft, 365);\r\n\t\t\t\t\t\t\t\t// console.log('reducer.CookieStorageService.set', this.key, draft);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\t\t});\r\n\t};\r\n\r\n\tretryState(times: number = 3, delay: number = 1000): (source: Observable<any>) => Observable<unknown> {\r\n\t\treturn (source: Observable<any>) => defer(() => {\r\n\t\t\t// initialize global values\r\n\t\t\tlet i = 0;\r\n\t\t\treturn source.pipe(\r\n\t\t\t\tretryWhen((errors) => errors.pipe(\r\n\t\t\t\t\tdelayWhen(() => timer(delay)),\r\n\t\t\t\t\tswitchMap((error) => {\r\n\t\t\t\t\t\t// next((draft: any) => draft.busy = false);\r\n\t\t\t\t\t\tif (i < times) {\r\n\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\tthis.state = (draft: any) => {\r\n\t\t\t\t\t\t\t\tdraft.retry = i;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\treturn of(i);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn throwError(error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t)),\r\n\t\t\t);\r\n\t\t});\r\n\t};\r\n\r\n\tcatchState(errorReducer?: (error: any) => any): (source: Observable<any>) => Observable<any> {\r\n\t\treturn (source: Observable<any>) =>\r\n\t\t\tdefer(() => {\r\n\t\t\t\t// initialize global values\r\n\t\t\t\treturn source.pipe(\r\n\t\t\t\t\ttakeUntil(this.cancel$.pipe(\r\n\t\t\t\t\t\ttap(() => {\r\n\t\t\t\t\t\t\tthis.state = (draft: any) => {\r\n\t\t\t\t\t\t\t\tdraft.busy = false;\r\n\t\t\t\t\t\t\t\tdraft.retry = null;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t)),\r\n\t\t\t\t\tcatchError(error => {\r\n\t\t\t\t\t\tthis.state = (draft: any) => {\r\n\t\t\t\t\t\t\tdraft.error = error;\r\n\t\t\t\t\t\t\tdraft.busy = false;\r\n\t\t\t\t\t\t\tdraft.retry = null;\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tif (typeof errorReducer === 'function') {\r\n\t\t\t\t\t\t\terror = errorReducer(error);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\terror = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn (error ? of(error) : of());\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t};\r\n\r\n\tcancel(): void {\r\n\t\tthis.cancel$.next();\r\n\t}\r\n}\r\n\r\nexport function useStore(state: any, type?: StoreType, key?: string): IStore {\r\n\tconst store = new Store(state, type, key);\r\n\treturn {\r\n\t\tstate$: store.state$,\r\n\t\tbusy$: store.busy$.bind(store),\r\n\t\tcached$: store.cached$.bind(store),\r\n\t\tselect$: store.select$.bind(store),\r\n\t\tselect: store.select.bind(store),\r\n\t\tnext: store.next.bind(store),\r\n\t\tnextError: store.nextError.bind(store),\r\n\t\treducer: store.reducer.bind(store),\r\n\t\tcatchState: store.catchState.bind(store),\r\n\t\tretryState: store.retryState.bind(store),\r\n\t\tcancel: store.cancel.bind(store),\r\n\t};\r\n}\r\n\r\n/*\r\nexport function makeNext<T, R>(callback: (data: T) => R) : OperatorFunction<T, R>\r\nexport function makeNext<T extends { data: any }>() : OperatorFunction<T, T['data']>\r\nexport function makeNext<T>() : OperatorFunction<T, T>\r\nexport function makeNext<T extends { data? : undefined } | { data: R }, R>(callback?: (data: T) => R) {\r\n  return (source: Observable<T>) => source.pipe(\r\n    map(value => typeof callback === 'function' ? callback(value) : (value.data ? value.data : value)),\r\n  );\r\n}\r\n*/\r\n\r\nfunction makeNext(state: BehaviorSubject<any>): (callback: (draft: any) => any) => void {\r\n\treturn (callback: (draft: any) => any) => {\r\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\r\n\t\t\tif (typeof callback === 'function') {\r\n\t\t\t\tcallback(draft);\r\n\t\t\t}\r\n\t\t\treturn draft;\r\n\t\t}));\r\n\t};\r\n}\r\n\r\nfunction makeNextError(state: BehaviorSubject<any>): (error: any) => Observable<any> {\r\n\treturn (error?: any) => {\r\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\r\n\t\t\tdraft.error = error;\r\n\t\t\tdraft.busy = false;\r\n\t\t\tdraft.retry = null;\r\n\t\t\treturn draft;\r\n\t\t}));\r\n\t\treturn of(error);\r\n\t};\r\n}\r\n\r\nfunction makeSelect(state: BehaviorSubject<any>): (callback: (draft: any) => any) => any {\r\n\treturn (callback: (draft: any) => any) => {\r\n\t\treturn callback(state.getValue());\r\n\t};\r\n}\r\n","import { Observable, of } from 'rxjs';\r\nimport { delay, tap } from 'rxjs/operators';\r\n\r\nconst DELAY: number = 300;\r\nlet PROGRESSIVE_INDEX: number = 0;\r\n\r\nexport interface ITodoItem {\r\n\tid?: number;\r\n\tname?: string;\r\n\tcompleted?: boolean;\r\n}\r\n\r\nexport default class ApiService {\r\n\r\n\tstatic load$(url: string): Observable<ITodoItem[]> {\r\n\t\t// simulate api call\r\n\t\treturn of(new Array(1).fill(0).map((x, i) => {\r\n\t\t\tconst id = new Date().valueOf() + i;\r\n\t\t\treturn { id: id, name: `${PROGRESSIVE_INDEX++} item ${id}` };\r\n\t\t})).pipe(\r\n\t\t\tdelay(DELAY * Math.random())\r\n\t\t);\r\n\t}\r\n\r\n\tstatic addItem$(url: string, item?: ITodoItem): Observable<ITodoItem> {\r\n\t\t// simulate api call\r\n\t\tconst id = new Date().valueOf();\r\n\t\treturn of({ id: id, name: `${PROGRESSIVE_INDEX++} item ${id}` }).pipe(\r\n\t\t\tdelay(DELAY * Math.random()),\r\n\t\t\ttap(() => {\r\n\t\t\t\tif (Math.random() < 0.6) {\r\n\t\t\t\t\tthrow (`simulated error ${id}`);\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t// simulate api error\r\n\t\t\t\t\treturn of(1).pipe(\r\n\t\t\t\t\t\tdelay(DELAY * Math.random()),\r\n\t\t\t\t\t\ttap(() => console.log('error')),\r\n\t\t\t\t\t\tswitchMap(() => throwError(`simulated error ${id}`))\r\n\t\t\t\t\t);\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tstatic clearItems$(url: string): Observable<ITodoItem[]> {\r\n\t\t// simulate api call\r\n\t\treturn of([]).pipe(\r\n\t\t\tdelay(DELAY * Math.random())\r\n\t\t);\r\n\t}\r\n\r\n\tstatic remove$(url: string, id: number): Observable<number> {\r\n\t\t// simulate api call\r\n\t\treturn of(id).pipe(\r\n\t\t\tdelay(DELAY * Math.random())\r\n\t\t);\r\n\t}\r\n\r\n\tstatic patch$(url: string, item: ITodoItem): Observable<ITodoItem> {\r\n\t\t// simulate api call\r\n\t\treturn of(item).pipe(\r\n\t\t\tdelay(DELAY * Math.random())\r\n\t\t);\r\n\t}\r\n}\r\n","import { merge, Observable } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { StoreType, useStore } from '../../../src/rxcomp-store';\r\nimport ApiService, { ITodoItem } from '../api/api.service';\r\n\r\nconst { state$, busy$, cached$, reducer, catchState, retryState, cancel } = useStore({\r\n\ttodolist: [],\r\n}, StoreType.Session, 'todolist');\r\n\r\nexport class TodoService {\r\n\r\n\tstatic get state$() {\r\n\t\treturn state$;\r\n\t}\r\n\r\n\tstatic get cancel() {\r\n\t\treturn cancel;\r\n\t}\r\n\r\n\tstatic loadWithCache$(): Observable<ITodoItem[] | unknown> {\r\n\t\treturn busy$().pipe(\r\n\t\t\tswitchMap(() => merge(cached$((state: any) => state.todolist) as Observable<ITodoItem[]>, ApiService.load$('url')).pipe(\r\n\t\t\t\treducer((todolist: ITodoItem[], state: any) => state.todolist = todolist),\r\n\t\t\t\tcatchState(console.log),\r\n\t\t\t\t// tap((todolist: ITodoItem[]) => next((state: any) => (state.todolist = todolist))),\r\n\t\t\t\t// catchError((error: any) => nextError(error))\r\n\t\t\t)));\r\n\t}\r\n\r\n\tstatic load$(): Observable<ITodoItem[] | unknown> {\r\n\t\treturn busy$().pipe(\r\n\t\t\tswitchMap(() => ApiService.load$('url').pipe(\r\n\t\t\t\treducer((todolist: ITodoItem[], state: any) => state.todolist = todolist),\r\n\t\t\t\tcatchState(console.log),\r\n\t\t\t)));\r\n\t}\r\n\r\n\tstatic addItem$(): Observable<ITodoItem | unknown> {\r\n\t\treturn busy$().pipe(\r\n\t\t\tswitchMap(() => ApiService.addItem$('url').pipe(\r\n\t\t\t\treducer((item: ITodoItem, state: any) => {\r\n\t\t\t\t\tstate.todolist.push(item)\r\n\t\t\t\t}),\r\n\t\t\t\tretryState(),\r\n\t\t\t\tcatchState(console.log),\r\n\t\t\t))\r\n\t\t);\r\n\t}\r\n\r\n\tstatic clearItems$(): Observable<ITodoItem[] | unknown> {\r\n\t\treturn busy$().pipe(\r\n\t\t\tswitchMap(() => ApiService.clearItems$('url').pipe(\r\n\t\t\t\treducer((items: ITodoItem[], state: any) => state.todolist = items),\r\n\t\t\t\tcatchState(console.log),\r\n\t\t\t))\r\n\t\t);\r\n\t}\r\n\r\n\tstatic removeItem$(id: number): Observable<number | unknown> {\r\n\t\treturn busy$().pipe(\r\n\t\t\tswitchMap(() => ApiService.remove$('url', id).pipe(\r\n\t\t\t\treducer((id: number, state: any) => {\r\n\t\t\t\t\tconst index = state.todolist.reduce((p: number, c: ITodoItem, i: number) => {\r\n\t\t\t\t\t\treturn c.id === id ? i : p;\r\n\t\t\t\t\t}, -1);\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\tstate.todolist.splice(index, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tcatchState(console.log),\r\n\t\t\t))\r\n\t\t);\r\n\t}\r\n\r\n\tstatic toggleCompleted$(item: ITodoItem): Observable<ITodoItem | unknown> {\r\n\t\treturn busy$().pipe(\r\n\t\t\tswitchMap(() => ApiService.patch$('url', item).pipe(\r\n\t\t\t\treducer((item: ITodoItem, state: any) => {\r\n\t\t\t\t\tconst stateItem = state.todolist.find((x: ITodoItem) => x.id === item.id);\r\n\t\t\t\t\tif (stateItem) {\r\n\t\t\t\t\t\tstateItem.completed = !stateItem.completed;\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tcatchState(console.log),\r\n\t\t\t)));\r\n\t}\r\n\r\n}\r\n\r\n","import { Component, getContext, IFactoryMeta } from 'rxcomp';\r\nimport { first, takeUntil } from 'rxjs/operators';\r\nimport { CookieStorageService, LocalStorageService, SessionStorageService } from '../../src/rxcomp-store';\r\nimport { ITodoItem } from './api/api.service';\r\nimport { TodoService } from './todo/todo.service';\r\n\r\nlet c: number = 0;\r\n\r\nexport default class AppComponent extends Component {\r\n\r\n\tonInit() {\r\n\t\tconst { node } = getContext(this);\r\n\t\tnode.classList.add('init');\r\n\t\tTodoService.state$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe((state) => {\r\n\t\t\tthis.state = state;\r\n\t\t\tthis.pushChanges();\r\n\t\t\tconsole.log('call', c++);\r\n\t\t});\r\n\t\tTodoService.loadWithCache$()\r\n\t\t\t.pipe(first())\r\n\t\t\t.subscribe(console.log);\r\n\t}\r\n\r\n\tonToggle(item: ITodoItem) {\r\n\t\tTodoService.toggleCompleted$(item).subscribe(console.log);\r\n\t}\r\n\r\n\tonAddItem() {\r\n\t\tTodoService.addItem$().subscribe(console.log);\r\n\t}\r\n\r\n\tonClearItems() {\r\n\t\tTodoService.clearItems$().subscribe(console.log);\r\n\t}\r\n\r\n\tonCancelRequest() {\r\n\t\tTodoService.cancel();\r\n\t}\r\n\r\n\tremoveItem(id: number) {\r\n\t\tTodoService.removeItem$(id).subscribe(console.log);\r\n\t}\r\n\r\n\tclearCookie() {\r\n\t\tCookieStorageService.clear();\r\n\t}\r\n\r\n\tclearLocalStorage() {\r\n\t\tLocalStorageService.clear();\r\n\t}\r\n\r\n\tclearSessionStorage() {\r\n\t\tSessionStorageService.clear();\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: '[app-component]',\r\n\t};\r\n\r\n}\r\n","import { CoreModule, IModuleMeta, Module } from 'rxcomp';\r\nimport { StoreModule } from '../../src/rxcomp-store';\r\nimport AppComponent from './app.component';\r\n\r\nexport default class AppModule extends Module {\r\n\r\n\tstatic meta: IModuleMeta = {\r\n\t\timports: [\r\n\t\t\tCoreModule,\r\n\t\t\tStoreModule\r\n\t\t],\r\n\t\tdeclarations: [\r\n\t\t],\r\n\t\tbootstrap: AppComponent,\r\n\t};\r\n\r\n}\r\n","import { Browser } from 'rxcomp';\r\nimport AppModule from './app.module';\r\n\r\nBrowser.bootstrap(AppModule);\r\n"]}