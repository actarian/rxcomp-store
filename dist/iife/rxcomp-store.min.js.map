{"version":3,"sources":["src/rxcomp-store.ts","../../src/storage/storage.service.ts","../../src/storage/cookie-storage.service.ts","../../src/storage/cookie-storage.component.ts","../../src/storage/local-storage.service.ts","../../src/storage/local-storage.component.ts","../../src/storage/session-storage.service.ts","../../src/storage/session-storage.component.ts","../../src/store.module.ts","../../src/store/store.ts"],"names":["this","rxcomp","store","exports","operators","rxjs","immer","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","StorageService","encode","decoded","Serializer","encodeJson","encodeURIComponent","encodeBase64","decode","encoded","decodeBase64","decodeURIComponent","decodeJson","isSupported","type","storage","flag","window","x","setItem","removeItem","error","DOMException","code","name","Boolean","CookieStorageService","_StorageService","apply","arguments","clear","_this","toRawArray","forEach","setter","delete","exist","document","cookie","indexOf","get","getRaw","set","value","days","find","setRaw","toArray","_this2","map","split","items","trim","filter","expires","date","Date","setTime","getTime","toUTCString","items$","next","ReplaySubject","CookieStorageComponent","_Component","active","_proto","onInit","pipe","takeUntil","unsubscribe$","subscribe","pushChanges","onToggle","onClear","onRemove","item","Component","selector","template","LocalStorageService","localStorage","undefined","getItem","keys","supported","LocalStorageComponent","SessionStorageService","sessionStorage","SessionStorageComponent","console","log","StoreType","factories","pipes","StoreModule","_Module","Module","declarations","concat","Store","state","Memory","cancel$","Subject","busy","state_","BehaviorSubject","callback","produce","getValue","draft","makeNext","nextError","retry","of","makeNextError","select","makeSelect","state$","asObservable","Constructor","protoProps","staticProps","busy$","cached$","Local","Session","Cookie","select$","distinctUntilChanged","reducer","_this3","source","defer","data","retryState","times","delay","_this4","retryWhen","errors","delayWhen","timer","switchMap","throwError","catchState","errorReducer","_this5","tap","catchError","cancel","useStore","bind"],"mappings":";;;;;AAMAA,KAAKC,OAAOD,KAAKC,QAAQ,GAAGD,KAAKC,OAAOC,MAAO,SAASC,EAAQF,EAAOG,EAAUC,EAAKC,GAAO,aAAa,SAASC,EAAkBC,EAAQC,GAC3I,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CACrC,IAAIE,EAAaH,EAAMC,GACvBE,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDC,OAAOC,eAAeT,EAAQI,EAAWM,IAAKN,IAUlD,SAASO,EAAeC,EAAUC,GAChCD,EAASE,UAAYN,OAAOO,OAAOF,EAAWC,WAC9CF,EAASE,UAAUE,YAAcJ,EACjCA,EAASK,UAAYJ,EACtB,ICnBoBK,EAAAA,WDoBnB,SAASA,KA6BT,OA3BAA,EClBMC,OAAP,SAAcC,GAEb,OAD6BC,EAAAA,WAAWF,OAAOC,EAAS,CAACE,EAAAA,WAAYC,mBAAoBC,EAAAA,gBAAkB,MDsB3GN,EClBMO,OAAP,SAAcC,GAEb,OADmBL,EAAAA,WAAWI,OAAOC,EAAS,CAACC,EAAAA,aAAcC,mBAAoBC,EAAAA,cDsBjFX,EClBMY,YAAP,SAAmBC,GAClB,IACIC,EADAC,GAAgB,EAEpB,IACCD,EAAUE,OAAOH,GACjB,IAAMI,EAAI,mBACVH,EAAQI,QAAQD,EAAGA,GACnBH,EAAQK,WAAWF,GACnBF,GAAO,EACN,MAAOK,GACRL,EAAOK,aAAiBC,eAER,KAAfD,EAAME,MAES,OAAfF,EAAME,MAGS,uBAAfF,EAAMG,MAES,+BAAfH,EAAMG,OAENC,QAAQV,GAA8B,IAAnBA,EAAQ7B,QAE7B,OAAO8B,GDYAf,ECjDYA,GAEbA,EAAAA,WAAqB,EAArB,ICNayB,EAAAA,SAAAA,GF0DnB,SAASA,IACP,OAAOC,EAAgBC,MAAMrD,KAAMsD,YAActD,KAsFnD,OAzFAmB,EAAegC,EAAsBC,GAMrCD,EE1DMI,MAAP,WF2DG,IAAIC,EAAQxD,KE1DdA,KAAKyD,aAAaC,SAAQ,SAAAf,GACzBa,EAAKG,OAAOhB,EAAEM,KAAM,IAAK,OFgE1BE,EE3DMS,OAAP,SAAcX,GACbjD,KAAK2D,OAAOV,EAAM,IAAK,IF8DvBE,EE3DMU,MAAP,SAAaZ,GACZ,OAAsD,IAA/Ca,SAASC,OAAOC,QAAQ,IAAMf,EAAO,MAAuD,IAAxCa,SAASC,OAAOC,QAAQf,EAAO,MF8D1FE,EE3DMc,IAAP,SAAWhB,GACV,OAAOjD,KAAKiC,OAAOjC,KAAKkE,OAAOjB,KF8D/BE,EE3DMgB,IAAP,SAAWlB,EAAcmB,EAAYC,GACpCrE,KAAK2D,OAAOV,EAAMjD,KAAK2B,OAAOyC,GAAQC,IF8DtClB,EE3DMe,OAAP,SAAcjB,GACb,IAAImB,EAAQ,KAENL,EADU/D,KAAKyD,aACEa,MAAK,SAAA3B,GAAC,OAAIA,EAAEM,OAASA,KAI5C,OAHIc,IACHK,EAAQL,EAAOK,OAETA,GFkEPjB,EE/DMoB,OAAP,SAActB,EAAcmB,EAAeC,GAC1CrE,KAAK2D,OAAOV,EAAMmB,EAAOC,IFkEzBlB,EE/DMqB,QAAP,WFgEG,IAAIC,EAASzE,KE/Df,OAAOA,KAAKyD,aAAaiB,KAAI,SAAA/B,GAE5B,OADAA,EAAEyB,MAAQK,EAAKxC,OAAOU,EAAEyB,OACjBzB,MFqERQ,EEjEMM,WAAP,WACC,OAAOK,SAASC,OAAOY,MAAM,KAAKD,KAAI,SAAA/B,GACrC,IAAMiC,EAAQjC,EAAEgC,MAAM,KACtB,MAAO,CAAE1B,KAAM2B,EAAM,GAAGC,OAAQT,MAAOQ,EAAM,GAAKA,EAAM,GAAGC,OAAS,SAClEC,QAAO,SAAAnC,GAAC,MAAe,KAAXA,EAAEM,SFyEjBE,EEtEMQ,OAAP,SAAcV,EAAcmB,EAAYC,GACvC,IAAIU,EACJ,GAAIV,EAAM,CACT,IAAMW,EAAO,IAAIC,KACjBD,EAAKE,QAAQF,EAAKG,UAAoB,GAAPd,EAAY,GAAK,GAAK,KACrDU,EAAU,aAAeC,EAAKI,mBAE9BL,EAAU,GAEXjB,SAASC,OAASd,EAAO,IAAMmB,EAAQW,EAAU,WACjD/E,KAAKqF,OAAOC,KAAKtF,KAAKwE,YF2EtBrB,EExEMb,YAAP,WAEC,MAD6C,oBAAXI,aAAqD,IAApBA,OAAOoB,UF4EnEX,EEjJYA,CAA6BzB,GAE1CyB,EAAAA,OAAwC,IAAIoC,EAAAA,cAAc,GAA1D,ICAaC,EAAAA,SAAAA,GAArB,SAAAA,IHqJI,IAAIhC,EAKJ,OAHAA,EAAQiC,EAAWpC,MAAMrD,KAAMsD,YAActD,MGrJhD0F,QAAkB,EAClBlC,EAAAoB,MAAwB,GHuJdpB,EARTrC,EAAeqE,EAAwBC,GAWvC,IAAIE,EAASH,EAAuBlE,UA0BpC,OAxBAqE,EG1JDC,OAAA,WH2JG,IAAInB,EAASzE,KG1JfA,KAAK4E,MAAQzB,EAAqBqB,UAClCrB,EAAqBkC,OAAOQ,KAC3BC,EAAAA,UAAU9F,KAAK+F,eACdC,WAAU,SAAApB,GACXH,EAAKG,MAAQA,EACbH,EAAKwB,kBH+JNN,EG3JDO,SAAA,WACClG,KAAK0F,QAAU1F,KAAK0F,OACpB1F,KAAKiG,eH8JLN,EG3JDQ,QAAA,WACChD,EAAqBI,SH8JrBoC,EG3JDS,SAAA,SAASC,GACRlD,EAAqBS,OAAOyC,EAAKpD,OH8J1BuC,EGvLYA,CAA+Bc,EAAAA,WA4B5Cd,EAAAA,KAAqB,CAC3Be,SAAU,2BACVC,SAAQ,uvBAFF,IC9BaC,EAAAA,SAAAA,GJiMnB,SAASA,IACP,OAAOrD,EAAgBC,MAAMrD,KAAMsD,YAActD,KAkFnD,OArFAmB,EAAesF,EAAqBrD,GAMpCqD,EIjMMlD,MAAP,WACKvD,KAAKsC,gBACRoE,aAAanD,QACbvD,KAAKqF,OAAOC,KAAKtF,KAAKwE,aJqMvBiC,EIjMM7C,OAAP,SAAcX,GACTjD,KAAKsC,gBACRoE,aAAa7D,WAAWI,GACxBjD,KAAKqF,OAAOC,KAAKtF,KAAKwE,aJqMvBiC,EIjMM5C,MAAP,SAAaZ,GACZ,QAAIjD,KAAKsC,oBAC8BqE,IAA/BD,aAAaE,QAAQ3D,IJuM7BwD,EIjMMxC,IAAP,SAAWhB,GACV,OAAOjD,KAAKiC,OAAOjC,KAAKkE,OAAOjB,KJoM/BwD,EIjMMtC,IAAP,SAAWlB,EAAcmB,GACxBpE,KAAKuE,OAAOtB,EAAMjD,KAAK2B,OAAOyC,KJoM9BqC,EIjMMvC,OAAP,SAAcjB,GACb,IAAImB,EAAQ,KAIZ,OAHIpE,KAAKsC,gBACR8B,EAAQsC,aAAaE,QAAQ3D,IAEvBmB,GJsMPqC,EInMMlC,OAAP,SAActB,EAAcmB,GACvBA,GAASpE,KAAKsC,gBACjBoE,aAAa9D,QAAQK,EAAMmB,GAC3BpE,KAAKqF,OAAOC,KAAKtF,KAAKwE,aJuMvBiC,EInMMjC,QAAP,WJoMG,IAAIhB,EAAQxD,KInMd,OAAOA,KAAKyD,aAAaiB,KAAI,SAAA/B,GAE5B,OADAA,EAAEyB,MAAQZ,EAAKvB,OAAOU,EAAEyB,OACjBzB,MJyMR8D,EIrMMhD,WAAP,WJsMG,IAAIgB,EAASzE,KIrMf,OAAIA,KAAKsC,cACDtB,OAAO6F,KAAKH,cAAchC,KAAI,SAAAxD,GACpC,MAAO,CACN+B,KAAM/B,EACNkD,MAAOK,EAAKP,OAAOhD,OAId,IJ2MRuF,EIvMMnE,YAAP,WACC,QAAItC,KAAK8G,WAGFpF,EAAeY,YAAY,iBJ2M3BmE,EIpRYA,CAA4B/E,GAEzC+E,EAAAA,OAAwC,IAAIlB,EAAAA,cAAc,GAA1D,ICAawB,EAAAA,SAAAA,GAArB,SAAAA,ILwRI,IAAIvD,EAKJ,OAHAA,EAAQiC,EAAWpC,MAAMrD,KAAMsD,YAActD,MKxRhD0F,QAAkB,EAClBlC,EAAAoB,MAAwB,GL0RdpB,EARTrC,EAAe4F,EAAuBtB,GAWtC,IAAIE,EAASoB,EAAsBzF,UA0BnC,OAxBAqE,EK7RDC,OAAA,WL8RG,IAAInB,EAASzE,KK7RfA,KAAK4E,MAAQ6B,EAAoBjC,UACjCiC,EAAoBpB,OAAOQ,KAC1BC,EAAAA,UAAU9F,KAAK+F,eACdC,WAAU,SAAApB,GACXH,EAAKG,MAAQA,EACbH,EAAKwB,kBLkSNN,EK9RDO,SAAA,WACClG,KAAK0F,QAAU1F,KAAK0F,OACpB1F,KAAKiG,eLiSLN,EK9RDQ,QAAA,WACCM,EAAoBlD,SLiSpBoC,EK9RDS,SAAA,SAASC,GACRI,EAAoB7C,OAAOyC,EAAKpD,OLiSzB8D,EK1TYA,CAA8BT,EAAAA,WA4B3CS,EAAAA,KAAqB,CAC3BR,SAAU,0BACVC,SAAQ,mwBAFF,IC9BaQ,EAAAA,SAAAA,GNoUnB,SAASA,IACP,OAAO5D,EAAgBC,MAAMrD,KAAMsD,YAActD,KAkFnD,OArFAmB,EAAe6F,EAAuB5D,GAMtC4D,EMpUMzD,MAAP,WACKvD,KAAKsC,gBACR2E,eAAe1D,QACfvD,KAAKqF,OAAOC,KAAKtF,KAAKwE,aNwUvBwC,EMpUMpD,OAAP,SAAcX,GACTjD,KAAKsC,gBACR2E,eAAepE,WAAWI,GAC1BjD,KAAKqF,OAAOC,KAAKtF,KAAKwE,aNwUvBwC,EMpUMnD,MAAP,SAAaZ,GACZ,QAAIjD,KAAKsC,oBACgCqE,IAAjCM,eAAeL,QAAQ3D,IN0U/B+D,EMpUM/C,IAAP,SAAWhB,GACV,OAAOjD,KAAKiC,OAAOjC,KAAKkE,OAAOjB,KNuU/B+D,EMpUM7C,IAAP,SAAWlB,EAAcmB,GACxBpE,KAAKuE,OAAOtB,EAAMjD,KAAK2B,OAAOyC,KNuU9B4C,EMpUM9C,OAAP,SAAcjB,GACb,IAAImB,EAAQ,KAIZ,OAHIpE,KAAKsC,gBACR8B,EAAQ6C,eAAeL,QAAQ3D,IAEzBmB,GNyUP4C,EMtUMzC,OAAP,SAActB,EAAcmB,GACvBA,GAASpE,KAAKsC,gBACjB2E,eAAerE,QAAQK,EAAMmB,GAC7BpE,KAAKqF,OAAOC,KAAKtF,KAAKwE,aN0UvBwC,EMtUMxC,QAAP,WNuUG,IAAIhB,EAAQxD,KMtUd,OAAOA,KAAKyD,aAAaiB,KAAI,SAAA/B,GAE5B,OADAA,EAAEyB,MAAQZ,EAAKvB,OAAOU,EAAEyB,OACjBzB,MN4URqE,EMxUMvD,WAAP,WNyUG,IAAIgB,EAASzE,KMxUf,OAAIA,KAAKsC,cACDtB,OAAO6F,KAAKI,gBAAgBvC,KAAI,SAAAxD,GACtC,MAAO,CACN+B,KAAM/B,EACNkD,MAAOK,EAAKP,OAAOhD,OAId,IN8UR8F,EM1UM1E,YAAP,WACC,QAAItC,KAAK8G,WAGFpF,EAAeY,YAAY,mBN8U3B0E,EMvZYA,CAA8BtF,GAE3CsF,EAAAA,OAAwC,IAAIzB,EAAAA,cAAc,GAA1D,ICAa2B,EAAAA,SAAAA,GAArB,SAAAA,IP2ZI,IAAI1D,EAKJ,OAHAA,EAAQiC,EAAWpC,MAAMrD,KAAMsD,YAActD,MO3ZhD0F,QAAkB,EAClBlC,EAAAoB,MAAwB,GP6ZdpB,EARTrC,EAAe+F,EAAyBzB,GAWxC,IAAIE,EAASuB,EAAwB5F,UA2BrC,OAzBAqE,EOhaDC,OAAA,WPiaG,IAAInB,EAASzE,KOhafA,KAAK4E,MAAQoC,EAAsBxC,UACnCwC,EAAsB3B,OAAOQ,KAC5BC,EAAAA,UAAU9F,KAAK+F,eACdC,WAAU,SAAApB,GACXH,EAAKG,MAAQA,EACbH,EAAKwB,kBPqaNN,EOjaDO,SAAA,WACClG,KAAK0F,QAAU1F,KAAK0F,OACpByB,QAAQC,IAAI,mCAAoCpH,KAAK0F,QACrD1F,KAAKiG,ePoaLN,EOjaDQ,QAAA,WACCa,EAAsBzD,SPoatBoC,EOjaDS,SAAA,SAASC,GACRW,EAAsBpD,OAAOyC,EAAKpD,OPoa3BiE,EO9bYA,CAAgCZ,EAAAA,WA6B7CY,EAAAA,KAAqB,CAC3BX,SAAU,4BACVC,SAAQ,uwBC/BV,ICEYa,EDFNC,EAA8B,CACnC9B,EACAuB,EACAG,GAGKK,EAAuB,GAoBRC,EAAAA,SAAAA,GR+anB,SAASA,IACP,OAAOC,EAAQpE,MAAMrD,KAAMsD,YAActD,KAG3C,OANAmB,EAAeqG,EAAaC,GAMrBD,EQnbYA,CAAoBE,EAAAA,QAEjCF,EAAAA,KAAoB,CAC1BG,aAAY,GAAAC,OACRN,EACAC,GAEJpH,QAAO,GAAAyH,OACHN,EACAC,KCjCMF,EAAAA,EAAAA,YAAAA,EAAAA,UAAS,KACpBA,EAAAA,OAAAA,GAAA,SACAA,EAAAA,EAAAA,QAAAA,GAAA,UACAA,EAAAA,EAAAA,MAAAA,GAAA,QACAA,EAAAA,EAAAA,OAAAA,GAAA,STkdD,ISjcaQ,EAAb,WAeC,SAAAA,EAAYC,EAAiBvF,EAAyBrB,QAA1C4G,IAAAA,IAAAA,EAAa,SAAIvF,IAAAA,IAAAA,EAAO8E,EAAAA,UAAUU,aAAQ7G,IAAAA,IAAAA,EAAc,SAVpElB,KAAAgI,QAAyB,IAAIC,EAAAA,QAW5BjI,KAAKuC,KAAOA,EACZvC,KAAKkB,IAAL,UAAqBA,EACrB4G,EAAMI,MAAO,EACbJ,EAAMhF,MAAQ,KACd,IAAMqF,EAAS,IAAIC,EAAAA,gBAAgBN,GACnC9H,KAAKsF,KAqLP,SAAkBwC,GACjB,OAAO,SAACO,GACPP,EAAMxC,KAAKgD,EAAAA,QAAQR,EAAMS,YAAY,SAACC,GAIrC,MAHwB,mBAAbH,GACVA,EAASG,GAEHA,OA3LIC,CAASN,GACrBnI,KAAK0I,UA+LP,SAAuBZ,GACtB,OAAO,SAAChF,GAOP,OANAgF,EAAMxC,KAAKgD,EAAAA,QAAQR,EAAMS,YAAY,SAACC,GAIrC,OAHAA,EAAM1F,MAAQA,EACd0F,EAAMN,MAAO,EACbM,EAAMG,MAAQ,KACPH,MAEDI,EAAAA,GAAG9F,IAvMO+F,CAAcV,GAC/BnI,KAAK8I,OA0MP,SAAoBhB,GACnB,OAAO,SAACO,GACP,OAAOA,EAASP,EAAMS,aA5MRQ,CAAWZ,GACzBnI,KAAKgJ,OAASb,EAAOc,eAxBvB,ITZsBC,EAAaC,EAAYC,ESY/CzD,EAAAkC,EAAAvG,UAAA,OAAAqE,EA2BC0D,MAAA,WTmcG,IAAI7F,EAAQxD,KSlcd,OAAO4I,EAAAA,GAAG,MAAM/C,KACff,EAAAA,QAAO,WAEN,OADWtB,EAAKsF,QAAO,SAAAhB,GAAK,OAAIA,EAAMI,UAErC1E,EAAKsE,MAAQ,SAACU,GACbA,EAAMN,MAAO,EACbM,EAAM1F,MAAQ,KACd0F,EAAMG,MAAQ,OAER,MAKT7C,EAAAA,UAAU9F,KAAKgI,WA1ClBrC,EA8CC2D,QAAA,SAAQjB,GTscL,IAAI5D,EAASzE,KSrcf,OAAO4I,EAAAA,GAAG,MAAM/C,KACfnB,EAAAA,KAAI,WACH,IAAIN,EAAQ,KAWZ,OAVIK,EAAKlC,OAAS8E,EAAAA,UAAUkC,MAC3BnF,EAAQqC,EAAoBxC,IAAIQ,EAAKvD,KAC3BuD,EAAKlC,OAAS8E,EAAAA,UAAUmC,QAClCpF,EAAQ4C,EAAsB/C,IAAIQ,EAAKvD,KAC7BuD,EAAKlC,OAAS8E,EAAAA,UAAUoC,SAClCrF,EAAQjB,EAAqBc,IAAIQ,EAAKvD,MAEnCkD,GAA6B,mBAAbiE,IACnBjE,EAAQiE,EAASjE,IAEXA,KAERU,EAAAA,QAAO,SAACnC,GAEP,OAAY,MAALA,OAhEXgD,EAqEC+D,QAAA,SAAQrB,GACP,OAAOrI,KAAKgJ,OAAOnD,KAClBnB,EAAAA,IAAI2D,GACJsB,EAAAA,yBAxEHhE,EA4ECmD,OAAA,SAAOT,KA5ER1C,EA8ECL,KAAA,SAAK+C,KA9EN1C,EAgFC+C,UAAA,SAAU5F,GACT,OAAO8F,EAAAA,MAjFTjD,EAoFCiE,QAAA,SAAcA,GTocX,IAAIC,EAAS7J,KSncf,OAAO,SAAC8J,GAAD,OAA2BC,EAAAA,OAAM,WAEvC,OAAOD,EAAOjE,KACbnB,EAAAA,KAAI,SAACsF,GAqBJ,MApBuB,mBAAZJ,IACVC,EAAK/B,MAAQ,SAACU,GACbA,EAAM1F,MAAQ,KACd0F,EAAMG,MAAQ,KACdiB,EAAQI,EAAMxB,GACdA,EAAMN,MAAO,EACT2B,EAAKtH,OAAS8E,EAAAA,UAAUkC,OAC3B9C,EAAoBtC,IAAI0F,EAAK3I,IAAKsH,GAG/BqB,EAAKtH,OAAS8E,EAAAA,UAAUmC,SAC3BxC,EAAsB7C,IAAI0F,EAAK3I,IAAKsH,GAGjCqB,EAAKtH,OAAS8E,EAAAA,UAAUoC,QAC3BtG,EAAqBgB,IAAI0F,EAAK3I,IAAKsH,EAAO,OAKtCwB,WA7GZrE,EAmHCsE,WAAA,SAAWC,EAAmBC,GTwc3B,IAAIC,EAASpK,KSvcf,YADUkK,IAAAA,IAAAA,EAAgB,QAAGC,IAAAA,IAAAA,EAAgB,KACtC,SAACL,GAAD,OAA6BC,EAAAA,OAAM,WAEzC,IAAIrJ,EAAI,EACR,OAAOoJ,EAAOjE,KACbwE,EAAAA,WAAU,SAACC,GAAD,OAAYA,EAAOzE,KAC5B0E,EAAAA,WAAU,WAAA,OAAMC,EAAAA,MAAML,MACtBM,EAAAA,WAAU,SAAC3H,GAEV,OAAIpC,EAAIwJ,GACPxJ,IACA0J,EAAKtC,MAAQ,SAACU,GACbA,EAAMG,MAAQjI,GAERkI,EAAAA,GAAGlI,IAEHgK,EAAAA,WAAW5H,gBAnIzB6C,EA2ICgF,WAAA,SAAWC,GTmdR,IAAIC,EAAS7K,KSldf,OAAO,SAAC8J,GAAD,OACNC,EAAAA,OAAM,WAEL,OAAOD,EAAOjE,KACbC,EAAAA,UAAU+E,EAAK7C,QAAQnC,KACtBiF,EAAAA,KAAI,WACHD,EAAK/C,MAAQ,SAACU,GACbA,EAAMN,MAAO,EACbM,EAAMG,MAAQ,WAIjBoC,EAAAA,YAAW,SAAAjI,GAWV,OAVA+H,EAAK/C,MAAQ,SAACU,GACbA,EAAM1F,MAAQA,EACd0F,EAAMN,MAAO,EACbM,EAAMG,MAAQ,OAGd7F,EAD2B,mBAAjB8H,EACFA,EAAa9H,GAEb,MAEO8F,EAAAA,GAAG9F,GAAS8F,EAAAA,cAnKlCjD,EAyKCqF,OAAA,WACChL,KAAKgI,QAAQ1C,QTtLO4D,ESYtBrB,GTZmCsB,ESYnC,CAAA,CAAAjI,IAAA,QAAA+C,IAAA,WAQE,OAAOjE,KAAK8I,QAAO,SAACN,GAAD,OAAgBA,MARrCrE,IAAA,SAWWkE,GACTrI,KAAKsF,KAAK+C,QTvBM9H,EAAkB2I,EAAY5H,UAAW6H,GACrDC,GAAa7I,EAAkB2I,EAAaE,GSUlDvB,EAAA,GAqOC,OAAA1H,EAAAqF,uBAAAA,EAAArF,EAAAgD,qBAAAA,EAAAhD,EAAA4G,sBAAAA,EAAA5G,EAAAsG,oBAAAA,EAAAtG,EAAA+G,wBAAAA,EAAA/G,EAAA6G,sBAAAA,EAAA7G,EAAA0H,MAAAA,EAAA1H,EAAAqH,YAAAA,EAAArH,EAAA8K,STuaD,SS9dyBnD,EAAYvF,EAAkBrB,GACtD,IAAMhB,EAAQ,IAAI2H,EAAMC,EAAOvF,EAAMrB,GACrC,MAAO,CACN8H,OAAQ9I,EAAM8I,OACdK,MAAOnJ,EAAMmJ,MAAM6B,KAAKhL,GACxBoJ,QAASpJ,EAAMoJ,QAAQ4B,KAAKhL,GAC5BwJ,QAASxJ,EAAMwJ,QAAQwB,KAAKhL,GAC5B4I,OAAQ5I,EAAM4I,OAAOoC,KAAKhL,GAC1BoF,KAAMpF,EAAMoF,KAAK4F,KAAKhL,GACtBwI,UAAWxI,EAAMwI,UAAUwC,KAAKhL,GAChC0J,QAAS1J,EAAM0J,QAAQsB,KAAKhL,GAC5ByK,WAAYzK,EAAMyK,WAAWO,KAAKhL,GAClC+J,WAAY/J,EAAM+J,WAAWiB,KAAKhL,GAClC8K,OAAQ9K,EAAM8K,OAAOE,KAAKhL,KA0C3BC,ET3P6C,CS2P7C,GAAAF,OAAAI,KAAAD,UAAAC,KAAAC","file":"dist\\iife\\rxcomp-store.min.js","sourcesContent":[null,"import { decodeBase64, decodeJson, encodeBase64, encodeJson, Serializer } from 'rxcomp';\r\n\r\nexport interface IStorageItem {\r\n\tname: string;\r\n\tvalue: any;\r\n}\r\n\r\nexport default class StorageService {\r\n\r\n\tstatic supported: boolean = false;\r\n\r\n\tstatic encode(decoded: any): string | null {\r\n\t\tlet encoded: string | null = Serializer.encode(decoded, [encodeJson, encodeURIComponent, encodeBase64]) || null;\r\n\t\treturn encoded;\r\n\t}\r\n\r\n\tstatic decode(encoded: string | null): any {\r\n\t\tlet decoded: any = Serializer.decode(encoded, [decodeBase64, decodeURIComponent, decodeJson]);\r\n\t\treturn decoded;\r\n\t}\r\n\r\n\tstatic isSupported(type: 'localStorage' | 'sessionStorage'): boolean {\r\n\t\tlet flag: boolean = false;\r\n\t\tlet storage;\r\n\t\ttry {\r\n\t\t\tstorage = window[type];\r\n\t\t\tconst x = '__storage_test__';\r\n\t\t\tstorage.setItem(x, x);\r\n\t\t\tstorage.removeItem(x);\r\n\t\t\tflag = true;\r\n\t\t} catch (error) {\r\n\t\t\tflag = error instanceof DOMException && (\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\terror.code === 22 ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\terror.code === 1014 ||\r\n\t\t\t\t// test name field too, because code might not be present\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\terror.name === 'QuotaExceededError' ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\terror.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\r\n\t\t\t\t// acknowledge QuotaExceededError only if there's something already stored\r\n\t\t\t\tBoolean(storage && storage.length !== 0);\r\n\t\t}\r\n\t\treturn flag;\r\n\t}\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class CookieStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tthis.toRawArray().forEach(x => {\r\n\t\t\tthis.setter(x.name, '', -1);\r\n\t\t\t// document.cookie = `${x.name}= ; expires = Thu, 01 Jan 1970 00:00:00 GMT`;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tthis.setter(name, '', -1);\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any, days?: number): void {\r\n\t\tthis.setter(name, this.encode(value), days);\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tconst cookies = this.toRawArray();\r\n\t\tconst cookie = cookies.find(x => x.name === name);\r\n\t\tif (cookie) {\r\n\t\t\tvalue = cookie.value;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string, days?: number): void {\r\n\t\tthis.setter(name, value, days);\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\treturn document.cookie.split(';').map(x => {\r\n\t\t\tconst items = x.split('=');\r\n\t\t\treturn { name: items[0].trim(), value: items[1] ? items[1].trim() : null }\r\n\t\t}).filter(x => x.name !== '');\r\n\t}\r\n\r\n\tstatic setter(name: string, value: any, days?: number): void {\r\n\t\tlet expires: string;\r\n\t\tif (days) {\r\n\t\t\tconst date = new Date();\r\n\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n\t\t\texpires = '; expires=' + date.toUTCString();\r\n\t\t} else {\r\n\t\t\texpires = '';\r\n\t\t}\r\n\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\r\n\t\tthis.items$.next(this.toArray());\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tconst isBrowser: boolean = typeof window !== 'undefined' && typeof window.document !== 'undefined';\r\n\t\treturn isBrowser;\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\nimport { takeUntil } from 'rxjs/operators';\nimport CookieStorageService from './cookie-storage.service';\nimport { IStorageItem } from './storage.service';\n\nexport default class CookieStorageComponent extends Component {\n\n\tactive: boolean = false;\n\titems: IStorageItem[] = [];\n\n\tonInit() {\n\t\tthis.items = CookieStorageService.toArray();\n\t\tCookieStorageService.items$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(items => {\n\t\t\tthis.items = items;\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n\tonToggle() {\n\t\tthis.active = !this.active;\n\t\tthis.pushChanges();\n\t}\n\n\tonClear() {\n\t\tCookieStorageService.clear();\n\t}\n\n\tonRemove(item: IStorageItem) {\n\t\tCookieStorageService.delete(item.name);\n\t}\n\n\tstatic meta: IFactoryMeta = {\n\t\tselector: 'cookie-storage-component',\n\t\ttemplate: `\n\t\t<div class=\"rxc-block\">\n\t\t\t<div class=\"rxc-head\">\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\n\t\t\t\t\t<span *if=\"!active\">+ cookie</span>\n\t\t\t\t\t<span *if=\"active\">- cookie</span>\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\n\t\t\t</div>\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>`,\n\t};\n}\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class LocalStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tlocalStorage.clear();\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tlocalStorage.removeItem(name);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn localStorage.getItem(name) !== undefined;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any): void {\r\n\t\tthis.setRaw(name, this.encode(value));\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tif (this.isSupported()) {\r\n\t\t\tvalue = localStorage.getItem(name);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string | null): void {\r\n\t\tif (value && this.isSupported()) {\r\n\t\t\tlocalStorage.setItem(name, value);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn Object.keys(localStorage).map(key => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: key,\r\n\t\t\t\t\tvalue: this.getRaw(key),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tif (this.supported) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn StorageService.isSupported('localStorage');\r\n\t\t/*\r\n\t\tlet supported = false;\r\n\t\ttry {\r\n\t\t\tsupported = 'localStorage' in window && localStorage !== null;\r\n\t\t\tif (supported) {\r\n\t\t\t\tlocalStorage.setItem('test', '1');\r\n\t\t\t\tlocalStorage.removeItem('test');\r\n\t\t\t} else {\r\n\t\t\t\tsupported = false;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\tthis.supported = supported;\r\n\t\treturn supported;\r\n\t\t*/\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport LocalStorageService from './local-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class LocalStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = LocalStorageService.toArray();\r\n\t\tLocalStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tLocalStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tLocalStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'local-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ localStorage</span>\r\n\t\t\t\t\t<span *if=\"active\">- localStorage</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\nimport StorageService, { IStorageItem } from \"./storage.service\";\n\nexport default class SessionStorageService extends StorageService {\n\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\n\n\tstatic clear(): void {\n\t\tif (this.isSupported()) {\n\t\t\tsessionStorage.clear();\n\t\t\tthis.items$.next(this.toArray());\n\t\t}\n\t}\n\n\tstatic delete(name: string): void {\n\t\tif (this.isSupported()) {\n\t\t\tsessionStorage.removeItem(name);\n\t\t\tthis.items$.next(this.toArray());\n\t\t}\n\t}\n\n\tstatic exist(name: string): boolean {\n\t\tif (this.isSupported()) {\n\t\t\treturn sessionStorage.getItem(name) !== undefined;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstatic get(name: string): any {\n\t\treturn this.decode(this.getRaw(name));\n\t}\n\n\tstatic set(name: string, value: any): void {\n\t\tthis.setRaw(name, this.encode(value));\n\t}\n\n\tstatic getRaw(name: string): string | null {\n\t\tlet value = null;\n\t\tif (this.isSupported()) {\n\t\t\tvalue = sessionStorage.getItem(name);\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic setRaw(name: string, value: string | null): void {\n\t\tif (value && this.isSupported()) {\n\t\t\tsessionStorage.setItem(name, value);\n\t\t\tthis.items$.next(this.toArray());\n\t\t}\n\t}\n\n\tstatic toArray(): IStorageItem[] {\n\t\treturn this.toRawArray().map(x => {\n\t\t\tx.value = this.decode(x.value);\n\t\t\treturn x;\n\t\t});\n\t}\n\n\tstatic toRawArray(): IStorageItem[] {\n\t\tif (this.isSupported()) {\n\t\t\treturn Object.keys(sessionStorage).map(key => {\n\t\t\t\treturn {\n\t\t\t\t\tname: key,\n\t\t\t\t\tvalue: this.getRaw(key),\n\t\t\t\t};\n\t\t\t});\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tstatic isSupported(): boolean {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\treturn StorageService.isSupported('sessionStorage');\n\t\t/*\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'sessionStorage' in window && sessionStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\tsessionStorage.setItem('test', '1');\n\t\t\t\tsessionStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t\t*/\n\t}\n}\n","import { Component, IFactoryMeta } from 'rxcomp';\nimport { takeUntil } from 'rxjs/operators';\nimport SessionStorageService from './session-storage.service';\nimport { IStorageItem } from './storage.service';\n\nexport default class SessionStorageComponent extends Component {\n\n\tactive: boolean = false;\n\titems: IStorageItem[] = [];\n\n\tonInit() {\n\t\tthis.items = SessionStorageService.toArray();\n\t\tSessionStorageService.items$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(items => {\n\t\t\tthis.items = items;\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n\tonToggle() {\n\t\tthis.active = !this.active;\n\t\tconsole.log('SessionStorageComponent.onToggle', this.active);\n\t\tthis.pushChanges();\n\t}\n\n\tonClear() {\n\t\tSessionStorageService.clear();\n\t}\n\n\tonRemove(item: IStorageItem) {\n\t\tSessionStorageService.delete(item.name);\n\t}\n\n\tstatic meta: IFactoryMeta = {\n\t\tselector: 'session-storage-component',\n\t\ttemplate: `\n\t\t<div class=\"rxc-block\">\n\t\t\t<div class=\"rxc-head\">\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\n\t\t\t\t\t<span *if=\"!active\">+ sessionStorage</span>\n\t\t\t\t\t<span *if=\"active\">- sessionStorage</span>\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\n\t\t\t</div>\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>`,\n\t};\n}\n","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\r\nimport CookieStorageComponent from './storage/cookie-storage.component';\r\nimport LocalStorageComponent from './storage/local-storage.component';\r\nimport SessionStorageComponent from './storage/session-storage.component';\r\n\r\nconst factories: typeof Factory[] = [\r\n\tCookieStorageComponent,\r\n\tLocalStorageComponent,\r\n\tSessionStorageComponent,\r\n];\r\n\r\nconst pipes: typeof Pipe[] = [\r\n];\r\n\r\n/**\r\n * StoreModule Class.\r\n * @example\r\n * export default class AppModule extends Module {}\r\n *\r\n * AppModule.meta = {\r\n *  imports: [\r\n *   CoreModule,\r\n *   StoreModule\r\n *  ],\r\n *  declarations: [\r\n *   ErrorsComponent\r\n *  ],\r\n *  bootstrap: AppComponent,\r\n * };\r\n * @extends Module\r\n */\r\nexport default class StoreModule extends Module {\r\n\r\n\tstatic meta: IModuleMeta = {\r\n\t\tdeclarations: [\r\n\t\t\t...factories,\r\n\t\t\t...pipes,\r\n\t\t],\r\n\t\texports: [\r\n\t\t\t...factories,\r\n\t\t\t...pipes,\r\n\t\t]\r\n\t};\r\n\r\n}\r\n","import { produce } from 'immer';\nimport { BehaviorSubject, defer, Observable, of, Subject, throwError, timer } from 'rxjs';\nimport { catchError, delayWhen, distinctUntilChanged, filter, map, retryWhen, switchMap, takeUntil, tap } from 'rxjs/operators';\nimport CookieStorageService from '../storage/cookie-storage.service';\nimport LocalStorageService from '../storage/local-storage.service';\nimport SessionStorageService from '../storage/session-storage.service';\n\nexport enum StoreType {\n\tMemory = 1,\n\tSession = 2,\n\tLocal = 3,\n\tCookie = 4,\n};\n\nexport interface IStore {\n\tbusy$: () => Observable<null>;\n\treducer: <T, R>(reducer: (data: T, draft: any) => R) => (source: Observable<T>) => Observable<any>;\n\tnext: (callback: (draft: any) => any) => any;\n\tnextError: (error: any) => Observable<any>;\n\tselect: (callback: (draft: any) => any) => any;\n\tselect$: (callback: (draft: any) => any) => any;\n\tcached$: (callback: (draft: any) => any) => any;\n\tcatchState: (error?: any) => any;\n\tretryState: (times?: number, delay?: number) => (source: Observable<any>) => Observable<any>;\n\tcancel: () => void;\n\tstate$: Observable<any>;\n}\n\nexport class Store {\n\n\ttype: StoreType;\n\tkey: string;\n\tstate$: Observable<any>;\n\tcancel$: Subject<void> = new Subject;\n\n\tget state() {\n\t\treturn this.select((draft: any) => draft);\n\t}\n\n\tset state(callback: (draft: any) => any) {\n\t\tthis.next(callback);\n\t}\n\n\tconstructor(state: any = {}, type = StoreType.Memory, key: string = 'store') {\n\t\tthis.type = type;\n\t\tthis.key = `rxcomp_${key}`;\n\t\tstate.busy = false;\n\t\tstate.error = null;\n\t\tconst state_ = new BehaviorSubject(state);\n\t\tthis.next = makeNext(state_);\n\t\tthis.nextError = makeNextError(state_);\n\t\tthis.select = makeSelect(state_);\n\t\tthis.state$ = state_.asObservable();\n\t}\n\n\tbusy$(): Observable<null> {\n\t\treturn of(null).pipe(\n\t\t\tfilter(() => {\n\t\t\t\tlet busy = this.select(state => state.busy);\n\t\t\t\tif (!busy) {\n\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\tdraft.busy = true;\n\t\t\t\t\t\tdraft.error = null;\n\t\t\t\t\t\tdraft.retry = null;\n\t\t\t\t\t};\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}),\n\t\t\ttakeUntil(this.cancel$),\n\t\t);\n\t}\n\n\tcached$(callback: (value: any) => any): Observable<any> {\n\t\treturn of(null).pipe(\n\t\t\tmap(() => {\n\t\t\t\tlet value = null;\n\t\t\t\tif (this.type === StoreType.Local) {\n\t\t\t\t\tvalue = LocalStorageService.get(this.key);\n\t\t\t\t} else if (this.type === StoreType.Session) {\n\t\t\t\t\tvalue = SessionStorageService.get(this.key);\n\t\t\t\t} else if (this.type === StoreType.Cookie) {\n\t\t\t\t\tvalue = CookieStorageService.get(this.key);\n\t\t\t\t}\n\t\t\t\tif (value && typeof callback === 'function') {\n\t\t\t\t\tvalue = callback(value);\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}),\n\t\t\tfilter((x) => {\n\t\t\t\t// console.log('value', x);\n\t\t\t\treturn x != null;\n\t\t\t})\n\t\t);\n\t}\n\n\tselect$(callback: (draft: any) => any): Observable<any> {\n\t\treturn this.state$.pipe(\n\t\t\tmap(callback),\n\t\t\tdistinctUntilChanged()\n\t\t);\n\t}\n\n\tselect(callback: (draft: any) => any): any { }\n\n\tnext(callback: (draft: any) => any): void { }\n\n\tnextError(error: any): Observable<any> {\n\t\treturn of();\n\t}\n\n\treducer<T, R>(reducer: (data: T, draft: any) => R) {\n\t\treturn (source: Observable<T>) => defer(() => {\n\t\t\t// initialize global values\n\t\t\treturn source.pipe(\n\t\t\t\tmap((data: T) => {\n\t\t\t\t\tif (typeof reducer === 'function') {\n\t\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\t\tdraft.error = null;\n\t\t\t\t\t\t\tdraft.retry = null;\n\t\t\t\t\t\t\treducer(data, draft);\n\t\t\t\t\t\t\tdraft.busy = false;\n\t\t\t\t\t\t\tif (this.type === StoreType.Local) {\n\t\t\t\t\t\t\t\tLocalStorageService.set(this.key, draft);\n\t\t\t\t\t\t\t\t// console.log('reducer.LocalStorageService.set', this.key, draft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.type === StoreType.Session) {\n\t\t\t\t\t\t\t\tSessionStorageService.set(this.key, draft);\n\t\t\t\t\t\t\t\t// console.log('reducer.SessionStorageService.set', this.key, draft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.type === StoreType.Cookie) {\n\t\t\t\t\t\t\t\tCookieStorageService.set(this.key, draft, 365);\n\t\t\t\t\t\t\t\t// console.log('reducer.CookieStorageService.set', this.key, draft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn data;\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\t};\n\n\tretryState(times: number = 3, delay: number = 1000): (source: Observable<any>) => Observable<unknown> {\n\t\treturn (source: Observable<any>) => defer(() => {\n\t\t\t// initialize global values\n\t\t\tlet i = 0;\n\t\t\treturn source.pipe(\n\t\t\t\tretryWhen((errors) => errors.pipe(\n\t\t\t\t\tdelayWhen(() => timer(delay)),\n\t\t\t\t\tswitchMap((error) => {\n\t\t\t\t\t\t// next((draft: any) => draft.busy = false);\n\t\t\t\t\t\tif (i < times) {\n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\t\t\tdraft.retry = i;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn of(i);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn throwError(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t)),\n\t\t\t);\n\t\t});\n\t};\n\n\tcatchState(errorReducer?: (error: any) => any): (source: Observable<any>) => Observable<any> {\n\t\treturn (source: Observable<any>) =>\n\t\t\tdefer(() => {\n\t\t\t\t// initialize global values\n\t\t\t\treturn source.pipe(\n\t\t\t\t\ttakeUntil(this.cancel$.pipe(\n\t\t\t\t\t\ttap(() => {\n\t\t\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\t\t\tdraft.busy = false;\n\t\t\t\t\t\t\t\tdraft.retry = null;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}),\n\t\t\t\t\t)),\n\t\t\t\t\tcatchError(error => {\n\t\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\t\tdraft.error = error;\n\t\t\t\t\t\t\tdraft.busy = false;\n\t\t\t\t\t\t\tdraft.retry = null;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (typeof errorReducer === 'function') {\n\t\t\t\t\t\t\terror = errorReducer(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\terror = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn (error ? of(error) : of());\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t});\n\t};\n\n\tcancel(): void {\n\t\tthis.cancel$.next();\n\t}\n}\n\nexport function useStore(state: any, type?: StoreType, key?: string): IStore {\n\tconst store = new Store(state, type, key);\n\treturn {\n\t\tstate$: store.state$,\n\t\tbusy$: store.busy$.bind(store),\n\t\tcached$: store.cached$.bind(store),\n\t\tselect$: store.select$.bind(store),\n\t\tselect: store.select.bind(store),\n\t\tnext: store.next.bind(store),\n\t\tnextError: store.nextError.bind(store),\n\t\treducer: store.reducer.bind(store),\n\t\tcatchState: store.catchState.bind(store),\n\t\tretryState: store.retryState.bind(store),\n\t\tcancel: store.cancel.bind(store),\n\t};\n}\n\n/*\nexport function makeNext<T, R>(callback: (data: T) => R) : OperatorFunction<T, R>\nexport function makeNext<T extends { data: any }>() : OperatorFunction<T, T['data']>\nexport function makeNext<T>() : OperatorFunction<T, T>\nexport function makeNext<T extends { data? : undefined } | { data: R }, R>(callback?: (data: T) => R) {\n  return (source: Observable<T>) => source.pipe(\n    map(value => typeof callback === 'function' ? callback(value) : (value.data ? value.data : value)),\n  );\n}\n*/\n\nfunction makeNext(state: BehaviorSubject<any>): (callback: (draft: any) => any) => void {\n\treturn (callback: (draft: any) => any) => {\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(draft);\n\t\t\t}\n\t\t\treturn draft;\n\t\t}));\n\t};\n}\n\nfunction makeNextError(state: BehaviorSubject<any>): (error: any) => Observable<any> {\n\treturn (error?: any) => {\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\n\t\t\tdraft.error = error;\n\t\t\tdraft.busy = false;\n\t\t\tdraft.retry = null;\n\t\t\treturn draft;\n\t\t}));\n\t\treturn of(error);\n\t};\n}\n\nfunction makeSelect(state: BehaviorSubject<any>): (callback: (draft: any) => any) => any {\n\treturn (callback: (draft: any) => any) => {\n\t\treturn callback(state.getValue());\n\t};\n}\n"]}