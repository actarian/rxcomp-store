{"version":3,"sources":["src/rxcomp-store.ts","../../src/storage/storage.service.ts","../../src/storage/cookie-storage.service.ts","../../src/storage/cookie-storage.component.ts","../../src/storage/local-storage.service.ts","../../src/storage/local-storage.component.ts","../../src/storage/session-storage.service.ts","../../src/storage/session-storage.component.ts","../../src/store.module.ts","../../src/store/store.ts"],"names":["g","f","exports","module","require","define","amd","globalThis","self","rxcomp","store","rxjs","operators","immer","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","StorageService","encode","value","encodedJson","cache","Map","json","JSON","stringify","has","set","btoa","encodeURIComponent","error","console","warn","decode","parse","decodeURIComponent","atob","isSupported","type","storage","flag","window","x","setItem","removeItem","DOMException","code","name","Boolean","CookieStorageService","_StorageService","apply","arguments","clear","_this","toRawArray","forEach","setter","delete","exist","document","cookie","indexOf","get","getRaw","days","find","setRaw","toArray","_this2","map","split","items","trim","filter","expires","date","Date","setTime","getTime","toUTCString","items$","next","ReplaySubject","CookieStorageComponent","_Component","active","_proto","onInit","pipe","takeUntil","unsubscribe$","subscribe","pushChanges","onToggle","onClear","onRemove","item","Component","selector","template","LocalStorageService","localStorage","undefined","getItem","keys","supported","LocalStorageComponent","SessionStorageService","sessionStorage","SessionStorageComponent","StoreType","factories","pipes","StoreModule","_Module","Module","declarations","concat","Store","state","Memory","busy","state_","BehaviorSubject","callback","produce","getValue","draft","makeNext","nextError","of","makeNextError","select","makeSelect","state$","asObservable","Constructor","protoProps","staticProps","busy$","cached$","Local","Session","Cookie","select$","distinctUntilChanged","reducer","_this3","source","defer","data","catchState","errorReducer","_this4","catchError","useStore","bind"],"mappings":"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","file":"dist\\umd\\rxcomp-store.min.js","sourcesContent":[null,"\r\nexport interface IStorageItem {\r\n\tname: string;\r\n\tvalue: any;\r\n}\r\n\r\nexport default class StorageService {\r\n\r\n\tstatic supported: boolean = false;\r\n\r\n\tstatic encode(value: any): string | null {\r\n\t\tlet encodedJson: string | null = null;\r\n\t\ttry {\r\n\t\t\tconst cache: Map<any, boolean> = new Map();\r\n\t\t\tconst json: string = JSON.stringify(value, function (key, value) {\r\n\t\t\t\tif (typeof value === 'object' && value != null) {\r\n\t\t\t\t\tif (cache.has(value)) {\r\n\t\t\t\t\t\t// Circular reference found, discard key\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcache.set(value, true);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t});\r\n\t\t\tencodedJson = btoa(encodeURIComponent(json));\r\n\t\t} catch (error) {\r\n\t\t\tconsole.warn('StorageService.encode.error', value, error);\r\n\t\t}\r\n\t\treturn encodedJson;\r\n\t}\r\n\r\n\tstatic decode(encodedJson: string | null): any {\r\n\t\tlet value: any;\r\n\t\tif (encodedJson) {\r\n\t\t\ttry {\r\n\t\t\t\tvalue = JSON.parse(decodeURIComponent(atob(encodedJson)));\r\n\t\t\t} catch (error) {\r\n\t\t\t\t// console.warn('StorageService.decode.error', encodedJson);\r\n\t\t\t\tvalue = encodedJson;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic isSupported(type: 'localStorage' | 'sessionStorage'): boolean {\r\n\t\tlet flag: boolean = false;\r\n\t\tlet storage;\r\n\t\ttry {\r\n\t\t\tstorage = window[type];\r\n\t\t\tconst x = '__storage_test__';\r\n\t\t\tstorage.setItem(x, x);\r\n\t\t\tstorage.removeItem(x);\r\n\t\t\tflag = true;\r\n\t\t} catch (error) {\r\n\t\t\tflag = error instanceof DOMException && (\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\terror.code === 22 ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\terror.code === 1014 ||\r\n\t\t\t\t// test name field too, because code might not be present\r\n\t\t\t\t// everything except Firefox\r\n\t\t\t\terror.name === 'QuotaExceededError' ||\r\n\t\t\t\t// Firefox\r\n\t\t\t\terror.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\r\n\t\t\t\t// acknowledge QuotaExceededError only if there's something already stored\r\n\t\t\t\tBoolean(storage && storage.length !== 0);\r\n\t\t}\r\n\t\treturn flag;\r\n\t}\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class CookieStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tthis.toRawArray().forEach(x => {\r\n\t\t\tthis.setter(x.name, '', -1);\r\n\t\t\t// document.cookie = `${x.name}= ; expires = Thu, 01 Jan 1970 00:00:00 GMT`;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tthis.setter(name, '', -1);\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\treturn document.cookie.indexOf(';' + name + '=') !== -1 || document.cookie.indexOf(name + '=') === 0;\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any, days?: number): void {\r\n\t\tthis.setter(name, this.encode(value), days);\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tconst cookies = this.toRawArray();\r\n\t\tconst cookie = cookies.find(x => x.name === name);\r\n\t\tif (cookie) {\r\n\t\t\tvalue = cookie.value;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string, days?: number): void {\r\n\t\tthis.setter(name, value, days);\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\treturn document.cookie.split(';').map(x => {\r\n\t\t\tconst items = x.split('=');\r\n\t\t\treturn { name: items[0].trim(), value: items[1] ? items[1].trim() : null }\r\n\t\t}).filter(x => x.name !== '');\r\n\t}\r\n\r\n\tstatic setter(name: string, value: any, days?: number): void {\r\n\t\tlet expires: string;\r\n\t\tif (days) {\r\n\t\t\tconst date = new Date();\r\n\t\t\tdate.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\r\n\t\t\texpires = '; expires=' + date.toUTCString();\r\n\t\t} else {\r\n\t\t\texpires = '';\r\n\t\t}\r\n\t\tdocument.cookie = name + '=' + value + expires + '; path=/';\r\n\t\tthis.items$.next(this.toArray());\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tconst isBrowser: boolean = typeof window !== 'undefined' && typeof window.document !== 'undefined';\r\n\t\treturn isBrowser;\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport CookieStorageService from './cookie-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class CookieStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = CookieStorageService.toArray();\r\n\t\tCookieStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tCookieStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tCookieStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'cookie-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ cookie</span>\r\n\t\t\t\t\t<span *if=\"active\">- cookie</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class LocalStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tlocalStorage.clear();\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tlocalStorage.removeItem(name);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn localStorage.getItem(name) !== undefined;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any): void {\r\n\t\tthis.setRaw(name, this.encode(value));\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tif (this.isSupported()) {\r\n\t\t\tvalue = localStorage.getItem(name);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string | null): void {\r\n\t\tif (value && this.isSupported()) {\r\n\t\t\tlocalStorage.setItem(name, value);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn Object.keys(localStorage).map(key => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: key,\r\n\t\t\t\t\tvalue: this.getRaw(key),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tif (this.supported) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn StorageService.isSupported('localStorage');\r\n\t\t/*\r\n\t\tlet supported = false;\r\n\t\ttry {\r\n\t\t\tsupported = 'localStorage' in window && localStorage !== null;\r\n\t\t\tif (supported) {\r\n\t\t\t\tlocalStorage.setItem('test', '1');\r\n\t\t\t\tlocalStorage.removeItem('test');\r\n\t\t\t} else {\r\n\t\t\t\tsupported = false;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\tthis.supported = supported;\r\n\t\treturn supported;\r\n\t\t*/\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport LocalStorageService from './local-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class LocalStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = LocalStorageService.toArray();\r\n\t\tLocalStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tLocalStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tLocalStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'local-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ localStorage</span>\r\n\t\t\t\t\t<span *if=\"active\">- localStorage</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { ReplaySubject } from \"rxjs\";\r\nimport StorageService, { IStorageItem } from \"./storage.service\";\r\n\r\nexport default class SessionStorageService extends StorageService {\r\n\r\n\tstatic items$: ReplaySubject<IStorageItem[]> = new ReplaySubject(1);\r\n\r\n\tstatic clear(): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tsessionStorage.clear();\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic delete(name: string): void {\r\n\t\tif (this.isSupported()) {\r\n\t\t\tsessionStorage.removeItem(name);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic exist(name: string): boolean {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn sessionStorage.getItem(name) !== undefined;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic get(name: string): any {\r\n\t\treturn this.decode(this.getRaw(name));\r\n\t}\r\n\r\n\tstatic set(name: string, value: any): void {\r\n\t\tthis.setRaw(name, this.encode(value));\r\n\t}\r\n\r\n\tstatic getRaw(name: string): string | null {\r\n\t\tlet value = null;\r\n\t\tif (this.isSupported()) {\r\n\t\t\tvalue = sessionStorage.getItem(name);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tstatic setRaw(name: string, value: string | null): void {\r\n\t\tif (value && this.isSupported()) {\r\n\t\t\tsessionStorage.setItem(name, value);\r\n\t\t\tthis.items$.next(this.toArray());\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toArray(): IStorageItem[] {\r\n\t\treturn this.toRawArray().map(x => {\r\n\t\t\tx.value = this.decode(x.value);\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tstatic toRawArray(): IStorageItem[] {\r\n\t\tif (this.isSupported()) {\r\n\t\t\treturn Object.keys(sessionStorage).map(key => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: key,\r\n\t\t\t\t\tvalue: this.getRaw(key),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isSupported(): boolean {\r\n\t\tif (this.supported) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn StorageService.isSupported('sessionStorage');\r\n\t\t/*\r\n\t\tlet supported = false;\r\n\t\ttry {\r\n\t\t\tsupported = 'sessionStorage' in window && sessionStorage !== null;\r\n\t\t\tif (supported) {\r\n\t\t\t\tsessionStorage.setItem('test', '1');\r\n\t\t\t\tsessionStorage.removeItem('test');\r\n\t\t\t} else {\r\n\t\t\t\tsupported = false;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\tthis.supported = supported;\r\n\t\treturn supported;\r\n\t\t*/\r\n\t}\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport SessionStorageService from './session-storage.service';\r\nimport { IStorageItem } from './storage.service';\r\n\r\nexport default class SessionStorageComponent extends Component {\r\n\r\n\tactive: boolean = false;\r\n\titems: IStorageItem[] = [];\r\n\r\n\tonInit() {\r\n\t\tthis.items = SessionStorageService.toArray();\r\n\t\tSessionStorageService.items$.pipe(\r\n\t\t\ttakeUntil(this.unsubscribe$)\r\n\t\t).subscribe(items => {\r\n\t\t\tthis.items = items;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonToggle() {\r\n\t\tthis.active = !this.active;\r\n\t\tthis.pushChanges();\r\n\t}\r\n\r\n\tonClear() {\r\n\t\tSessionStorageService.clear();\r\n\t}\r\n\r\n\tonRemove(item: IStorageItem) {\r\n\t\tSessionStorageService.delete(item.name);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: 'session-storage-component',\r\n\t\ttemplate: `\r\n\t\t<div class=\"rxc-block\">\r\n\t\t\t<div class=\"rxc-head\">\r\n\t\t\t\t<span class=\"rxc-head__title\" (click)=\"onToggle()\">\r\n\t\t\t\t\t<span *if=\"!active\">+ sessionStorage</span>\r\n\t\t\t\t\t<span *if=\"active\">- sessionStorage</span>\r\n\t\t\t\t\t<span [innerHTML]=\"' {' + items.length + ')'\"></span>\r\n\t\t\t\t</span>\r\n\t\t\t\t<span class=\"rxc-head__remove\" (click)=\"onClear()\">x</span>\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"rxc-list\" *if=\"active\">\r\n\t\t\t\t<li class=\"rxc-list__item\" *for=\"let item of items\">\r\n\t\t\t\t\t<span class=\"rxc-list__name\" [innerHTML]=\"item.name\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__value\" [innerHTML]=\"item.value | json\"></span>\r\n\t\t\t\t\t<span class=\"rxc-list__remove\" (click)=\"onRemove(item)\">x</span>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t</div>`,\r\n\t};\r\n}\r\n","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\nimport CookieStorageComponent from './storage/cookie-storage.component';\nimport LocalStorageComponent from './storage/local-storage.component';\nimport SessionStorageComponent from './storage/session-storage.component';\n\nconst factories: typeof Factory[] = [\n\tCookieStorageComponent,\n\tLocalStorageComponent,\n\tSessionStorageComponent,\n];\n\nconst pipes: typeof Pipe[] = [\n];\n\n/**\n * StoreModule Class.\n * @example\n * export default class AppModule extends Module {}\n *\n * AppModule.meta = {\n *  imports: [\n *   CoreModule,\n *   StoreModule\n *  ],\n *  declarations: [\n *   ErrorsComponent\n *  ],\n *  bootstrap: AppComponent,\n * };\n * @extends Module\n */\nexport default class StoreModule extends Module {\n\n\tstatic meta: IModuleMeta = {\n\t\tdeclarations: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t],\n\t\texports: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t]\n\t};\n\n}\n","import { produce } from 'immer';\nimport { BehaviorSubject, defer, Observable, of } from 'rxjs';\nimport { catchError, distinctUntilChanged, filter, map } from 'rxjs/operators';\nimport CookieStorageService from '../storage/cookie-storage.service';\nimport LocalStorageService from '../storage/local-storage.service';\nimport SessionStorageService from '../storage/session-storage.service';\n\nexport enum StoreType {\n\tMemory = 1,\n\tSession = 2,\n\tLocal = 3,\n\tCookie = 4,\n};\n\nexport interface IStore {\n\tbusy$: () => Observable<null>,\n\treducer: <T, R>(reducer: (data: T, draft: any) => R) => (source: Observable<T>) => Observable<any>,\n\tnext: (callback: (draft: any) => any) => any,\n\tnextError: (error: any) => Observable<any>,\n\tselect: (callback: (draft: any) => any) => any,\n\tselect$: (callback: (draft: any) => any) => any,\n\tcached$: (callback: (draft: any) => any) => any,\n\tcatchState: (error?: any) => any,\n\tstate$: Observable<any>,\n}\n\nexport class Store {\n\n\ttype: StoreType;\n\tkey: string;\n\tstate$: Observable<any>;\n\n\tget state() {\n\t\treturn this.select((draft: any) => draft);\n\t}\n\n\tset state(callback: (draft: any) => any) {\n\t\tthis.next(callback);\n\t}\n\n\tconstructor(state: any = {}, type = StoreType.Memory, key: string = 'store') {\n\t\tthis.type = type;\n\t\tthis.key = `rxcomp_${key}`;\n\t\tstate.busy = false;\n\t\tstate.error = null;\n\t\tconst state_ = new BehaviorSubject(state);\n\t\tthis.next = makeNext(state_);\n\t\tthis.nextError = makeNextError(state_);\n\t\tthis.select = makeSelect(state_);\n\t\tthis.state$ = state_.asObservable();\n\t}\n\n\tbusy$(): Observable<null> {\n\t\treturn of(null).pipe(\n\t\t\tfilter(() => {\n\t\t\t\tlet busy = this.select(state => state.busy);\n\t\t\t\tif (!busy) {\n\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\tdraft.busy = true;\n\t\t\t\t\t\tdraft.error = null;\n\t\t\t\t\t};\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\n\tcached$(callback: (value: any) => any): Observable<any> {\n\t\treturn of(null).pipe(\n\t\t\tmap(() => {\n\t\t\t\tlet value = null;\n\t\t\t\tif (this.type === StoreType.Local) {\n\t\t\t\t\tvalue = LocalStorageService.get(this.key);\n\t\t\t\t} else if (this.type === StoreType.Session) {\n\t\t\t\t\tvalue = SessionStorageService.get(this.key);\n\t\t\t\t} else if (this.type === StoreType.Cookie) {\n\t\t\t\t\tvalue = CookieStorageService.get(this.key);\n\t\t\t\t}\n\t\t\t\tif (value && typeof callback === 'function') {\n\t\t\t\t\tvalue = callback(value);\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}),\n\t\t\tfilter((x) => {\n\t\t\t\t// console.log('value', x);\n\t\t\t\treturn x != null;\n\t\t\t})\n\t\t);\n\t}\n\n\tselect$(callback: (draft: any) => any): Observable<any> {\n\t\treturn this.state$.pipe(\n\t\t\tmap(callback),\n\t\t\tdistinctUntilChanged()\n\t\t);\n\t}\n\n\tselect(callback: (draft: any) => any): any { }\n\n\tnext(callback: (draft: any) => any): void { }\n\n\tnextError(error: any): Observable<any> {\n\t\treturn of();\n\t}\n\n\treducer<T, R>(reducer: (data: T, draft: any) => R) {\n\t\treturn (source: Observable<T>) => defer(() => {\n\t\t\t// initialize global values\n\t\t\treturn source.pipe(\n\t\t\t\tmap((data: T) => {\n\t\t\t\t\tif (typeof reducer === 'function') {\n\t\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\t\tdraft.error = null;\n\t\t\t\t\t\t\treducer(data, draft);\n\t\t\t\t\t\t\tdraft.busy = false;\n\t\t\t\t\t\t\tif (this.type === StoreType.Local) {\n\t\t\t\t\t\t\t\tLocalStorageService.set(this.key, draft);\n\t\t\t\t\t\t\t\t// console.log('reducer.LocalStorageService.set', this.key, draft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.type === StoreType.Session) {\n\t\t\t\t\t\t\t\tSessionStorageService.set(this.key, draft);\n\t\t\t\t\t\t\t\t// console.log('reducer.SessionStorageService.set', this.key, draft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (this.type === StoreType.Cookie) {\n\t\t\t\t\t\t\t\tCookieStorageService.set(this.key, draft, 365);\n\t\t\t\t\t\t\t\t// console.log('reducer.CookieStorageService.set', this.key, draft);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn data;\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\t};\n\n\tcatchState(errorReducer?: (error: any) => any): (source: Observable<any>) => Observable<any> {\n\t\treturn (source: Observable<any>) =>\n\t\t\tdefer(() => {\n\t\t\t\t// initialize global values\n\t\t\t\treturn source.pipe(\n\t\t\t\t\tcatchError(error => {\n\t\t\t\t\t\tthis.state = (draft: any) => {\n\t\t\t\t\t\t\tdraft.error = error;\n\t\t\t\t\t\t\tdraft.busy = false;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (typeof errorReducer === 'function') {\n\t\t\t\t\t\t\terror = errorReducer(error);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\terror = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn (error ? of(error) : of());\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\t};\n\n}\n\nexport function useStore(state: any, type?: StoreType, key?: string): IStore {\n\tconst store = new Store(state, type, key);\n\treturn {\n\t\tstate$: store.state$,\n\t\tbusy$: store.busy$.bind(store),\n\t\tcached$: store.cached$.bind(store),\n\t\tselect$: store.select$.bind(store),\n\t\tselect: store.select.bind(store),\n\t\tnext: store.next.bind(store),\n\t\tnextError: store.nextError.bind(store),\n\t\treducer: store.reducer.bind(store),\n\t\tcatchState: store.catchState.bind(store),\n\t};\n}\n\n/*\nexport function makeNext<T, R>(callback: (data: T) => R) : OperatorFunction<T, R>\nexport function makeNext<T extends { data: any }>() : OperatorFunction<T, T['data']>\nexport function makeNext<T>() : OperatorFunction<T, T>\nexport function makeNext<T extends { data? : undefined } | { data: R }, R>(callback?: (data: T) => R) {\n  return (source: Observable<T>) => source.pipe(\n    map(value => typeof callback === 'function' ? callback(value) : (value.data ? value.data : value)),\n  );\n}\n*/\n\nfunction makeNext(state: BehaviorSubject<any>): (callback: (draft: any) => any) => void {\n\treturn (callback: (draft: any) => any) => {\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\n\t\t\tif (typeof callback === 'function') {\n\t\t\t\tcallback(draft);\n\t\t\t}\n\t\t\treturn draft;\n\t\t}));\n\t};\n}\n\nfunction makeNextError(state: BehaviorSubject<any>): (error: any) => Observable<any> {\n\treturn (error?: any) => {\n\t\tstate.next(produce(state.getValue(), (draft: any) => {\n\t\t\tdraft.error = error;\n\t\t\tdraft.busy = false;\n\t\t\treturn draft;\n\t\t}));\n\t\treturn of(error);\n\t};\n}\n\nfunction makeSelect(state: BehaviorSubject<any>): (callback: (draft: any) => any) => any {\n\treturn (callback: (draft: any) => any) => {\n\t\treturn callback(state.getValue());\n\t};\n}\n"]}