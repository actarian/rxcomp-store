/**
 * @license rxcomp-store v1.0.0-beta.10
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxcomp"),require("rxjs/operators"),require("rxjs"),require("immer")):"function"==typeof define&&define.amd?define(["exports","rxcomp","rxjs/operators","rxjs","immer"],e):e(((t=t||self).rxcomp=t.rxcomp||{},t.rxcomp.form={}),t.rxcomp,t.rxjs.operators,t.rxjs,t.immer)}(this,(function(t,e,n,r,i){"use strict";function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var a=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).active=!1,e}return s(e,t),e.prototype.onToggle=function(){this.active=!this.active,this.pushChanges()},e}(e.Component);a.meta={selector:"json-component",inputs:["item"],template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ json </span>\n\t\t\t\t\t<span *if="active">- json </span>\n\t\t\t\t\t<span [innerHTML]="item"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item">\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item | json"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var c=function(){function t(){}return t.encode=function(t){var e=null;try{var n=new Map,r=JSON.stringify(t,(function(t,e){if("object"==typeof e&&null!=e){if(n.has(e))return;n.set(e,!0)}return e}));e=btoa(encodeURIComponent(r))}catch(e){console.warn("StorageService.encode.error",t,e)}return e},t.decode=function(t){var e;if(t)try{e=JSON.parse(decodeURIComponent(atob(t)))}catch(n){e=t}return e},t.isSupported=function(t){var e,n=!1;try{e=window[t];var r="__storage_test__";e.setItem(r,r),e.removeItem(r),n=!0}catch(t){n=t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&Boolean(e&&0!==e.length)}return n},t}();c.supported=!1;var u=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){var t=this;this.toRawArray().forEach((function(e){t.setter(e.name,"",-1)}))},e.delete=function(t){this.setter(t,"",-1)},e.exist=function(t){return-1!==document.cookie.indexOf(";"+t+"=")||0===document.cookie.indexOf(t+"=")},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e,n){this.setter(t,this.encode(e),n)},e.getRaw=function(t){var e=null,n=this.toRawArray().find((function(e){return e.name===t}));return n&&(e=n.value),e},e.setRaw=function(t,e,n){this.setter(t,e,n)},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){return document.cookie.split(";").map((function(t){var e=t.split("=");return{name:e[0].trim(),value:e[1]?e[1].trim():null}})).filter((function(t){return""!==t.name}))},e.setter=function(t,e,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toUTCString()}else r="";document.cookie=t+"="+e+r+"; path=/",this.items$.next(this.toArray())},e.isSupported=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(c);u.items$=new r.ReplaySubject(1);var l=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(e,t);var r=e.prototype;return r.onInit=function(){var t=this;this.items=u.toArray(),u.items$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){u.clear()},r.onRemove=function(t){u.delete(t.name)},e}(e.Component);l.meta={selector:"cookie-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ cookie</span>\n\t\t\t\t\t<span *if="active">- cookie</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var p=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(localStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(localStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==localStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=localStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(localStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(localStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||c.isSupported("localStorage")},e}(c);p.items$=new r.ReplaySubject(1);var f=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(e,t);var r=e.prototype;return r.onInit=function(){var t=this;this.items=p.toArray(),p.items$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){p.clear()},r.onRemove=function(t){p.delete(t.name)},e}(e.Component);f.meta={selector:"local-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ localStorage</span>\n\t\t\t\t\t<span *if="active">- localStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var m=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(sessionStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(sessionStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==sessionStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=sessionStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(sessionStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(sessionStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||c.isSupported("sessionStorage")},e}(c);m.items$=new r.ReplaySubject(1);var h=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(e,t);var r=e.prototype;return r.onInit=function(){var t=this;this.items=m.toArray(),m.items$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){m.clear()},r.onRemove=function(t){m.delete(t.name)},e}(e.Component);h.meta={selector:"session-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ sessionStorage</span>\n\t\t\t\t\t<span *if="active">- sessionStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var v=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.transform=function(t){var e=new Map;return JSON.stringify(t,(function(t,n){if("object"==typeof n&&null!=n){if(e.has(n))return"#ref";e.set(n,!0)}return n}),2)},e}(e.Pipe);v.meta={name:"json"};var d,y=[a,l,f,h],g=[v],x=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(e.Module);x.meta={declarations:[].concat(y,g),exports:[].concat(y,g)},(d=t.StoreType||(t.StoreType={}))[d.Memory=1]="Memory",d[d.Session=2]="Session",d[d.Local=3]="Local",d[d.Cookie=4]="Cookie";var S=function(){function e(e,n,o){void 0===e&&(e={}),void 0===n&&(n=t.StoreType.Memory),void 0===o&&(o="store"),this.type=n,this.key="rxcomp_"+o,e.busy=!1,e.error=null;var s=new r.BehaviorSubject(e);this.next=function(t){return function(e){t.next(i.produce(t.getValue(),(function(t){return"function"==typeof e&&e(t),t})))}}(s),this.nextError=function(t){return function(e){return t.next(i.produce(t.getValue(),(function(t){return t.error=e,t.busy=!1,t}))),r.of(e)}}(s),this.select=function(t){return function(e){return e(t.getValue())}}(s),this.state$=s.asObservable()}var s,a,c,l=e.prototype;return l.busy$=function(){var t=this;return r.of(null).pipe(n.filter((function(){return!t.select((function(t){return t.busy}))&&(t.state=function(t){t.busy=!0,t.error=null},!0)})))},l.cached$=function(e){var i=this;return r.of(null).pipe(n.map((function(){var n=null;return i.type===t.StoreType.Local?n=p.get(i.key):i.type===t.StoreType.Session?n=m.get(i.key):i.type===t.StoreType.Cookie&&(n=u.get(i.key)),n&&"function"==typeof e&&(n=e(n)),n})),n.filter((function(t){return null!=t})))},l.select$=function(t){return this.state$.pipe(n.map(t),n.distinctUntilChanged())},l.select=function(t){},l.next=function(t){},l.nextError=function(t){return r.of()},l.reducer=function(e){var i=this;return function(o){return r.defer((function(){return o.pipe(n.map((function(n){return"function"==typeof e&&(i.state=function(r){r.error=null,e(n,r),r.busy=!1,i.type===t.StoreType.Local&&p.set(i.key,r),i.type===t.StoreType.Session&&m.set(i.key,r),i.type===t.StoreType.Cookie&&u.set(i.key,r,365)}),n})))}))}},l.catchState=function(t){var e=this;return function(i){return r.defer((function(){return i.pipe(n.catchError((function(n){return e.state=function(t){t.error=n,t.busy=!1},(n="function"==typeof t?t(n):null)?r.of(n):r.of()})))}))}},s=e,(a=[{key:"state",get:function(){return this.select((function(t){return t}))},set:function(t){this.next(t)}}])&&o(s.prototype,a),c&&o(s,c),e}();t.CookieStorageComponent=l,t.CookieStorageService=u,t.JsonComponent=a,t.LocalStorageComponent=f,t.LocalStorageService=p,t.SessionStorageComponent=h,t.SessionStorageService=m,t.Store=S,t.StoreModule=x,t.useStore=function(t,e,n){var r=new S(t,e,n);return{state$:r.state$,busy$:r.busy$.bind(r),cached$:r.cached$.bind(r),select$:r.select$.bind(r),select:r.select.bind(r),next:r.next.bind(r),nextError:r.nextError.bind(r),reducer:r.reducer.bind(r),catchState:r.catchState.bind(r)}},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=rxcomp-store.min.js.map